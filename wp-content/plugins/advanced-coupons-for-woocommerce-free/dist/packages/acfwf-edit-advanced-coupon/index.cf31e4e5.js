function fi(){import.meta.url,import("_").catch(()=>1);async function*e(){}}function Ze(){const{cart_condition_fields:e,cart_condition_field_groups:t,product_table_buttons:o,add_new_and_rule:n}=acfw_edit_coupon,i=Object.keys(e).map(c=>e[c]);return'\n    <div class="condition-group-actions">\n      <div class="add-condition-form" style="display: none;">\n        <select class="condition-types" data-placeholder="Search/select condition fields">\n          <option value="">Search</option>\n          '.concat(t.map(c=>Ke(c,i)).join(""),'\n        </select>\n        <button type="button" class="add-condition-field button-primary">').concat(o.add,'</button>\n        <button type="button" class="cancel-add-condition-field button">').concat(o.cancel,'</button>\n      </div>\n      <button type="button" class="add-condition-trigger button">\n        <i class="dashicons dashicons-plus"></i>\n        ').concat(n,"\n      </button>\n    </div>\n  ")}function Ke(e,t){const{group:o,label:n}=e,i=t.filter(c=>c.group===o||o==="others"&&c.group===void 0);if(i.length)return'\n    <optgroup label="'.concat(n,'">\n      ').concat(i.map(c=>'<option value="'.concat(c.key,'">').concat(c.title,"</option>")).join(""),"\n    </optgroup>\n  ")}function Xe(){jQuery("select.condition-types").select2()}const Q=jQuery,te=document.querySelector("#acfw_cart_conditions");function ve(){const e=Q(this),t=e.closest("div.condition-group-actions");e.hasClass("add-condition-trigger")?(t.find(".add-condition-form").show(),Xe(),e.hide()):(t.find(".add-condition-form").hide(),t.find(".add-condition-trigger").show())}function O(e){Q(te).data("editing",e),Q(te).find("#save-cart-conditions").prop("disabled",!e)}function et(){const e=Q(this),t=e.closest(".condition-field"),o=t.find("select.condition-value"),n=e.val()+"",i=t.data("selected_terms"),c=Q(te).data("custom_tax_options"),a=c.filter(d=>d.slug==n),s=a.length?a[0].terms:[];if(o.val(null).find("option").remove(),!!s.length){for(let d of s){let{name:r,term_id:p}=d,u=new Option(r,p);o.append(u)}o.val(i).trigger("change")}}function tt(){const e=Q(this),t=e.closest(".condition-field"),o=t.find("select.condition-value"),n=e.val()+"";if(!n)return;const i=t.data("regions"),c=Q(te).data("shipping_regions"),a=t.data("zones")[n].regions;if(o.val(null).find("option").remove(),!(typeof a!="object"||!a.length)){for(let s of a){const d=new Option(c[s],s);o.append(d)}o.val(i).trigger("change")}}function ot(){var e=Q(this),t=Q("select.non-qualifying-notice-type-field"),o=t.closest(".condition-settings-field");e.is(":checked")?(o.show(),t.prop("disabled",!1)):(o.hide(),t.prop("disabled",!0))}function H(e,t=""){t||(t="show");let o=t==="show"?"block":"none";jQuery(e).css("display",o)}function j(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039"};return e.replace(/[&<>"']/g,o=>t[o])}function nt(){const{decimal_separator:e}=acfw_edit_coupon,t=jQuery(this);let o=t.val()+"";o=="0"+e&&t.val("0"),!(o=="0"||o.substring(0,2)=="0"+e)&&(o=o.replace(/^0+/,""),o=o.substring(0,1)==e?"0"+o:o,t.val(o))}function ge(e){return e=="<"?1:0}function T(e,t){return e==t?"selected":""}function me(e,t){return e.indexOf(t)>=0?"selected":""}function De(e=""){const{exactly:t,anyexcept:o,morethan:n,lessthan:i}=acfw_edit_coupon.condition_field_options;return'\n        <option value="=" '.concat(T(e,"="),">").concat(t,'</option>\n        <option value="!=" ').concat(T(e,"!="),">").concat(o,'</option>\n        <option value=">" ').concat(T(e,">"),">").concat(n,'</option>\n        <option value="<" ').concat(T(e,"<"),">").concat(i,"</option>\n    ")}function Le(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}function re(e){const{decimal_separator:t}=acfw_edit_coupon;return parseFloat(e.replace(t,"."))}function Te(e,t){return e==="percent"||e==="fixed"?0<re(t):!0}function it(e){return new RegExp(/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i).test(e)}function Qe(e=""){const{logic_field_options:t}=acfw_edit_coupon,{and:o,or:n}=t;return'\n        <div class="condition-group-logic">\n            <div class="field-control">\n                <select class="cgroup-logic">\n                    <option value="and" '.concat(T(e,"and"),">").concat(o,'</option>\n                    <option value="or" ').concat(T(e,"or"),">").concat(n,"</option>\n                </select>\n            </div>\n        </div>\n    ")}function ue(e=""){const{empty_cart_conditions_field:t}=acfw_edit_coupon,o=Ze(),n='<div class="empty-conditions">'.concat(t,"</div>");return'\n        <div class="condition-group '.concat(e?"":"new",'">\n            <a class="remove-condition-group" href="javascript:void(0);">\n                <i class="dashicons dashicons-trash"></i>\n            </a>\n            <div class="condition-group-fields">\n                ').concat(e||n,"\n            </div>\n            ").concat(o,"\n        </div>\n    ")}var L=jQuery;function ct(){const e=document.querySelector("#acfw_cart_conditions .condition-data-wrap .condition-groups");L(e).find(".condition-group").length&&L(e).append(Qe("or")),L(e).find(".no-condition-group").remove(),L(e).append(ue()),L(this).blur(),L(e).find(".condition-group.new .add-condition-trigger").trigger("click"),L(e).find(".condition-group").removeClass("new"),O(!0)}function at(){const e=L(this),t=document.querySelector("#acfw_cart_conditions"),o=e.closest(".condition-group"),n=o.index()==0?o.next(".condition-group-logic"):o.prev(".condition-group-logic"),{no_condition_group_msg:i}=acfw_edit_coupon;o.remove(),n.remove(),L(t).find(".condition-group").length<1&&L(t).find(".condition-groups").append('\n            <div class="no-condition-group">\n                '.concat(i,"\n            </div>\n        ")),O(!0)}function Oe(e=""){const{logic_field_options:t}=acfw_edit_coupon,{and:o,or:n}=t;return'<div class="logic-condition-field condition-field" data-type="logic">\n        <div class="field-control">\n            <select class="condition-logic">\n                <option value="and" '.concat(T(e,"and"),">").concat(o,'</option>\n                <option value="or" ').concat(T(e,"or"),">").concat(n,"</option>\n            </select>\n        </div>\n    </div>")}const{cart_condition_fields:pe,condition_field_options:st}=acfw_edit_coupon;function lt(e){const{value:t,condition:o,quantity:n}=e,{title:i,placeholder:c,field:a}=pe.product_category,{field:s}=pe.cart_quantity,{condition_label:d}=acfw_edit_coupon,{exactly:r,anyexcept:p,morethan:u,lessthan:w}=st,$=o||">";return'\n    <div class="product-category-field condition-field" data-type="product-category">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(i,'</h3>\n        <div class="field-control categories">\n            <label>').concat(a,'</label>\n            <select class="condition-value wc-enhanced-select" multiple data-placeholder="').concat(c,'">\n                ').concat(dt(t),'\n            </select>\n        </div>\n        <div class="field-control condition">\n            <label>').concat(d,'</label>\n            <select class="condition-select">\n                <option value="=" ').concat($=="="?"selected":"",">").concat(r,'</option>\n                <option value="!=" ').concat($=="!="?"selected":"",">").concat(p,'</option>\n                <option value=">" ').concat($==">"?"selected":"",">").concat(u,'</option>\n                <option value="<" ').concat($=="<"?"selected":"",">").concat(w,'</option>\n            </select>\n        </div>\n        <div class="field-control quantity">\n            <label>').concat(s,'</label>\n            <input type="number" class="condition-quantity" value="').concat(n,'" min="').concat(o=="<"?1:0,'">\n        </div>\n    </div>\n    ')}function dt(e=[]){const{options:t}=pe.product_category;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(me(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:Me}=acfw_edit_coupon;function rt(e){const{title:t}=Me.customer_logged_in_status;return'\n        <div class="customer-logged-in-status-field condition-field" data-type="customer-logged-in-status">\n\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n\n        <h3 class="condition-field-title">'.concat(t,'</h3>\n\n        <div class="field-control">\n            <select class="condition-value">\n                ').concat(ut(e),"\n            </select>\n        </div>\n    </div>")}function ut(e){const{options:t}=Me.customer_logged_in_status;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(T(n,e),">").concat(t[n],"</option>");return o}const{cart_condition_fields:pt}=acfw_edit_coupon;function _t(e){const{title:t,placeholder:o}=pt.customer_user_role;return'\n        <div class="customer-user-role-field condition-field" data-type="customer-user-role">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(t,'</h3>\n            <div class="field-control">\n                <select class="wc-enhanced-select condition-value" multiple data-placeholder="').concat(o,'">\n                    ').concat(ft(e),"\n                </select>\n            </div>\n        </div>\n    ")}function ft(e){const{user_role_options:t}=acfw_edit_coupon;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(me(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:gt}=acfw_edit_coupon;function mt(e){const{title:t,placeholder:o}=gt.disallowed_customer_user_role;return'\n        <div class="disallowed-customer-user-role-field condition-field" data-type="disallowed-customer-user-role">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(t,'</h3>\n            <div class="field-control">\n                <select class="wc-enhanced-select condition-value" multiple data-placeholder="').concat(o,'">\n                    ').concat(ht(e),"\n                </select>\n            </div>\n        </div>\n    ")}function ht(e){const{user_role_options:t}=acfw_edit_coupon;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(me(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:bt}=acfw_edit_coupon;function vt(e){const{condition:t,value:o}=e,{title:n,desc:i,field:c}=bt.cart_quantity,{condition_label:a}=acfw_edit_coupon;return'\n    <div class="cart-quantity-field condition-field" data-type="cart-quantity">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(n,"</h3>\n        <label>").concat(i,'</label>\n        <div class="field-control">\n            <label>').concat(a,'</label>\n            <select class="condition-select">\n                ').concat(De(t),'\n            </select>\n        </div>\n        <div class="field-control">\n            <label>').concat(c,'</label>\n            <input class="condition-value" type="number" min="0" value="').concat(o>=0?o:"",'">\n        </div>\n    </div>\n    ')}function yt(e){const{condition:t,value:o,include_tax:n}=e,{cart_condition_fields:i,condition_label:c}=acfw_edit_coupon,{title:a,desc:s,field:d,tax_label:r}=i.cart_subtotal;return'\n    <div class="cart-subtotal-field condition-field" data-type="cart-subtotal">\n    <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n    <h3 class="condition-field-title">'.concat(a,"</h3>\n    <label>").concat(s,'</label>\n    <div class="field-control">\n      <label>').concat(c,'</label>\n      <select class="condition-select">\n        ').concat(De(t),'\n      </select>\n    </div>\n    <div class="field-control">\n      <label>').concat(d,'</label>\n      <input class="condition-value wc_input_price" type="text" value="').concat(o||"",'">\n    </div>\n    <div class="field-control no-label">\n      <label><input type="checkbox" class="condition-include-tax" type="checkbox" ').concat(n==="yes"?"checked":""," /> ").concat(r,"</label>\n    </div>\n    </div>\n    ")}const{cart_condition_fields:wt}=acfw_edit_coupon;function $t(e,t){const o=t.replace(/-/g,"_"),{title:n}=wt[o],{cart_condition_field_premium_notice:i}=acfw_edit_coupon;return'\n  <div class="'.concat(t,' condition-field condition-field-premium" data-type="').concat(t,"\" data-premium='").concat(JSON.stringify(e),'\'>\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">').concat(n,'</h3>\n      <div class="field-control">\n          ').concat(i.label,"\n      </div>\n  </div>\n  ")}const ee=jQuery,{cart_condition_premium_notice:ye,cart_condition_fields:we,upsell:xt}=acfw_edit_coupon;function kt(){const e=ee(this),t=e.closest(".condition-group-actions").find("select.condition-types"),o=e.closest(".condition-group"),n=o.find(".condition-group-fields"),i=document.querySelector("#acfw_cart_conditions .acfw-overlay"),c=ee("#acfw_cart_conditions").data("premium-conditions"),a=t.val()+"",s=n.find(".condition-field,.condition-set").length;if(H(i,"show"),c&&c.indexOf(a)>-1)vex.dialog.alert({unsafeMessage:xt.cart_condition_field});else{const d=Ae(a,null,s);d?(n.find(".empty-conditions").remove(),n.show().append(d),n.find(".".concat(a,"-field")).find("input,select").trigger("change"),ee("body").trigger("wc-enhanced-select-init"),O(!0)):vex.dialog.alert(acfw_edit_coupon.fail_add_condition_field)}H(i,"hide"),o.find(".condition-group-actions .add-condition-form").hide(),o.find(".condition-group-actions .add-condition-trigger").show()}function Ct(){const e=ee(this),t=e.closest(".condition-field,.condition-set"),o=t.closest(".condition-group"),n=t.index()==0?t.next(".logic-condition-field"):t.prev(".logic-condition-field"),{empty_cart_conditions_field:i}=acfw_edit_coupon;t.remove(),n.remove(),o.find(".condition-field,.condition-set").length<1&&o.find(".condition-group-fields").append('\n            <div class="empty-conditions">\n                '.concat(i,"\n            </div>\n        ")),O(!0)}function Ae(e,t=null,o=0){let n="";switch(e){case"product-category":t=t||{},t.length&&(t={condition:">",value:t,quantity:0}),n+=lt(t);break;case"customer-logged-in-status":n+=rt(t);break;case"customer-user-role":t=t||[],n+=_t(t);break;case"disallowed-customer-user-role":t=t||[],n+=mt(t);break;case"cart-quantity":t=t||{},n+=vt(t);break;case"cart-subtotal":t=t||{},n+=yt(t);break;default:const i=e.replace(/-/g,"_");if(we[i]){const{template_callback:c,default_data_value:a,title:s}=we[i];if(a&&(t=t||a),c&&(n+=c(t,i)),ye){let{label_premium:d}=ye;s&&s.includes(d)&&(t=t||{},n+=$t(t,e))}}break}return n&&o?Oe()+n:n}function qt(e){return acfw_edit_coupon.cart_conditon_field_options.indexOf(e)>-1}const I=jQuery,{cart_condition_premium_notice:$e,cart_condition_fields:xe}=acfw_edit_coupon;function Ft(e){var n;const t=e.querySelectorAll(".condition-set,.condition-field");let o=[];return e.classList.contains("condition-group-logic")?{type:"group_logic",value:(n=e.querySelector("select"))==null?void 0:n.value}:(t.forEach(i=>o.push(jt(i))),o.length?{type:"group",fields:o}:null)}function jt(e){const{type:t}=e.dataset;let o={type:t,data:null},n,i,c;switch(t){case"logic":n=e.querySelector("select.condition-logic"),o.data=n.value;break;case"product-category":n=e.querySelector(".condition-value"),i=e.querySelector(".condition-select"),c=e.querySelector(".condition-quantity"),o.data={condition:I(i).val(),value:I(n).val(),quantity:I(c).val()};break;case"customer-logged-in-status":case"customer-user-role":case"disallowed-customer-user-role":n=e.querySelector(".condition-value"),o.data=I(n).val();break;case"cart-quantity":n=e.querySelector(".condition-select"),i=e.querySelector(".condition-value"),o.data={condition:I(n).val(),value:parseInt(I(i).val())};break;case"cart-subtotal":const a=e.querySelector("input.condition-include-tax");n=e.querySelector(".condition-select"),i=e.querySelector(".condition-value"),o.data={condition:I(n).val(),value:I(i).val(),include_tax:a.checked?"yes":"no"};break;default:const s=t==null?void 0:t.replace(/-/g,"_");if(xe[s]){const{scraper_callback:d,title:r}=xe[s];if(d&&(o.data=d(e)),$e){let{label_premium:p}=$e;if(r&&r.includes(p)){const{premium:u}=e.dataset;o.data=u?JSON.parse(u):""}}}break}return o}const q=jQuery,{post_id:St}=woocommerce_admin_meta_boxes;function Dt(){const e=document.querySelector("#acfw_cart_conditions"),t=e.querySelectorAll(".condition-groups .condition-group, .condition-groups .condition-group-logic"),o=e.querySelector(".acfw-overlay"),{post_status:n}=acfw_edit_coupon,{post_id:i}=woocommerce_admin_meta_boxes;let c=[];if(q(e).find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click"),t.forEach(d=>{const r=Ft(d);r&&c.push(r)}),!Qt(c)){vex.dialog.alert(acfw_edit_coupon.cart_conditions_invalid),q(e).addClass("save-error");return}const a={message:q(e).find(".text-input.non-qualifying-message-field").val(),btn_text:q(e).find(".text-input.non-qualifying-btn-text-field").val(),btn_url:q(e).find(".text-input.non-qualifying-btn-url-field").val(),notice_type:q(e).find(".non-qualifying-notice-type-field").val()},s=q(e).find(".display-notice-auto-apply-field").is(":checked")?"yes":"";if(a.btn_url&&!Le(a.btn_url)){vex.dialog.alert(acfw_edit_coupon.cart_notice_url_invalid),q(e).addClass("save-error");return}H(o,"show"),Tt({cart_conditions:c,notice_settings:a,auto_apply_display:s,nonce:q(e).data("nonce")},d=>{d.status=="success"?n!=="publish"&&(q("input[name='post_title']").val()||q("input[name='post_title']").val("coupon-"+i),q("select[name='post_status']").append(new Option("Published","publish")).val("publish"),q("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),q("input#publish").click()):d.error_msg&&vex.dialog.alert(d.error_msg),O(!1),q(e).find("#save-cart-conditions").prop("disabled",!0),H(o,"hide")})}function Lt(e){const t=document.querySelector("#acfw_cart_conditions");q(t).data("editing")&&(e.preventDefault(),q(t).find("#save-cart-conditions").trigger("click"),setTimeout(()=>{q(t).hasClass("save-error")?q(t).removeClass("save-error"):q("form#post").submit()},1e3))}function Tt(e,t){return e.action="acfw_save_cart_conditions",e.coupon_id=St,q.post(ajaxurl,e,t,"json")}function Qt(e){var p;let t,o,n,i,c,a,s,d;if(e.length===1&&((p=e[0].fields)==null?void 0:p.length)<1)return!0;let r="";for(t of e){if(t.type==="group_logic"){if(!r||r==="group_logic")return!1;r="group_logic";continue}if(r=t.type,t.fields===void 0||t.fields.length<1)return!1;for(o of t.fields)if(i=o.type,n=o.data,n===void 0||n===""||n===null||(typeof n=="object"&&typeof n.length=="number"?c=n:i==="product-category"?(c=n.value,a=n.condition,s=n.quantity):typeof n=="object"&&n.length===void 0?(c=n.products,a=n.condition,s=n.value):s=n,d=ge(a),c!==void 0&&c.length<1||a!==void 0&&!a||!Number.isInteger(s)&&s!==void 0&&!s||Number.isInteger(s)&&s<d||typeof s=="number"&&s<d))return!1}return!0}const G=jQuery,{product_table_buttons:Ot,condition_field_options:Mt,bogo_form_fields:At}=acfw_edit_coupon;function It(){const e=G(this),t=e.closest(".acfw-styled-table"),o=t.find("tbody"),n=t.data("exclude");o.find("tr.no-result").remove(),o.append(Ne(n)),G("body").trigger("wc-enhanced-select-init")}function Nt(){const e=G(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=t.find("td.product").data("product");let c=o.data("exclude");c.splice(c.indexOf(i.product_id),1),n.find("tr.no-result").remove(),t.replaceWith(Ne(c,i)),o.data("exclude",c),o.find(".wc-product-search").data("exclude",c),G("body").trigger("wc-enhanced-select-init")}function Et(){const e=G(this),t=e.closest("tr"),o=e.closest("table.acfw-styled-table"),n=t.find(".wc-product-search"),i=t.find(".condition-select"),c=t.find(".condition-quantity"),a=i.val()==="<"?1:0;let s=o.data("exclude");if(!n.val()||!i.val()||!c.val()||parseInt(c.val())<a){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}const d=parseInt(n.val());if(s.includes(d)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}const r={product_id:d,condition:i.val(),quantity:parseInt(c.val()+""),product_label:n.find("option:selected").text(),condition_label:i.find("option:selected").text()};let p='\n        <tr>\n            <td class="product" data-product="'.concat(j(JSON.stringify(r)),'">').concat(r.product_label,'</td>\n            <td class="condition">').concat(r.condition_label,'</td>\n            <td class="quantity">').concat(r.quantity,'</td>\n            <td class="actions">\n                <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n                <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n            </td>\n        </tr>\n    ');s.push(r.product_id),t.replaceWith(p),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),O(!0)}function Ht(){const e=jQuery(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=t.find("td.product").data("product"),c=t.find("td").length;let a=o.data("exclude");if(a.includes(i.product_id)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}if(typeof i=="object"){const{product_id:s,product_label:d,condition_label:r,quantity:p}=i;let u='\n            <tr>\n                <td class="product" data-product="'.concat(j(JSON.stringify(i)),'">').concat(d,'</td>\n                <td class="condition">').concat(r,'</td>\n                <td class="quantity">').concat(p,'</td>\n                <td class="actions">\n                    <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n                    <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n                </td>\n            </tr>\n        ');a.push(s),t.replaceWith(u),o.data("exclude",a),o.find(".wc-product-search").data("exclude",a)}else t.remove(),Ie(n,c)}function Vt(){const e=jQuery(this),t=e.closest("tr"),o=t.closest("table"),n=o.find("tbody"),i=t.find("td").length;t.remove();let c=t.find("td.product").data("product"),a=o.data("exclude"),s=a.indexOf(parseInt(c.product_id));s!==-1&&a.splice(s,1),o.data("exclude",a),o.find(".wc-product-search").data("exclude",a),Ie(n,i),O(!0)}function Ie(e,t=3){e.find("tr").length>0||e.append('\n        <tr class="no-result">\n            <td colspan="'.concat(t,'">').concat(acfw_edit_coupon.no_products_added,"</td>\n        </tr>\n    "))}function Ne(e=[],t=!1){let o="",n="";if(typeof t=="object"){const{product_id:k,product_label:D}=t;o='<option value="'.concat(k,'">').concat(D,"</option>"),n=t.condition}const{add:i,edit:c,cancel:a}=Ot,{exactly:s,anyexcept:d,morethan:r,lessthan:p}=Mt,{type_to_search:u}=At,w=typeof t=="object"?c:i;return'\n        <tr class="add-edit-form adding">\n            <td class="product" data-product="'.concat(typeof t=="object"?j(JSON.stringify(t)):0,'">\n                <div class="object-search-wrap">\n                    <select class="product-in-cart wc-product-search"\n                        data-placeholder="').concat(u,'"\n                        data-action="acfw_search_products"\n                        data-exclude="').concat(j(JSON.stringify(e)),'">').concat(o,'</select>\n                </div>\n            </td>\n            <td class="condition">\n                <select class="condition-select">\n                    <option value="=" ').concat(n=="="?"selected":"",">").concat(s,'</option>\n                    <option value="!=" ').concat(n=="!="?"selected":"",">").concat(d,'</option>\n                    <option value=">" ').concat(n==">"?"selected":"",">").concat(r,'</option>\n                    <option value="<" ').concat(n=="<"?"selected":"",">").concat(p,'</option>\n                </select>\n            </td>\n            <td class="quantity">\n                <input type="number" class="condition-quantity" value="').concat(typeof t=="object"?t.quantity:1,'" min="').concat(n=="<"?1:0,'">\n            </td>\n            <td class="actions">\n                <button type="button" class="condition-product-add button-primary">').concat(w,'</button>\n                <button type="button" class="cancel button">').concat(a,"</button>\n            </td>\n        </tr>\n        ")}const R=jQuery;function Pt(){const e=R(this),t=parseInt(e.attr("min"));parseFloat(e.val()+"")<t&&e.val(t)}function zt(){const e=R(this),t=e.closest(".condition-field,.condition-set"),o=t.data("type"),n=o=="product-quantity"||o=="has-ordered-before"||o=="product-category"?"input.condition-quantity":"input.condition-value",i=t.find(n),c=e.val()+"";let a=ge(c);i.attr("min",a).trigger("change")}function Jt(){const{within_a_period_label:e,number_of_orders_label:t}=acfw_edit_coupon,o=R(this),n=o.closest(".cart-quantity-field"),i=n.find(".condition-type-value label");o.val()=="within-a-period"?i.text(e):i.text(t)}function Rt(){const e=R(this),t=e.closest(".condition-field"),o=t.find("select.condition-select"),n=o.val()+"";let i=e.val()+"",c=ge(n);acfw_edit_coupon.decimal_separator!=="."&&(i=i.replace(acfw_edit_coupon.decimal_separator,".")),!(!o||parseFloat(i)>c-1)&&e.val(c)}function Ut(){const e=R(this);let t=e.val();t=="0"+acfw_edit_coupon.decimal_separator&&e.val("0"),!(t=="0"||t.substring(0,2)=="0"+acfw_edit_coupon.decimal_separator)&&(t=t.replace(/^0+/,""),t=t.substring(0,1)==acfw_edit_coupon.decimal_separator?"0"+t:t,e.val(t))}function Wt(){const e=R(this),t=e.closest(".condition-field"),o=t.find("select.condition-select"),n=t.find("input.condition-value");switch(e.val()){case"string":n.prop("type","text"),n.removeClass("wc_input_price"),(o.val()==">"||o.val()=="<")&&o.val("="),o.find("option[value='>'],option[value='<']").prop("disabled",!0);break;case"number":n.prop("type","number"),n.removeClass("wc_input_price"),o.find("option[value='>'],option[value='<']").prop("disabled",!1);break;case"price":n.prop("type","text"),n.addClass("wc_input_price"),o.find("option[value='>'],option[value='<']").prop("disabled",!1);break}o.trigger("change")}function Bt(){window.acfw_edit_coupon_triggers=window.acfw_edit_coupon_triggers||{},window.acfw_edit_coupon_triggers.remove_all_premium_condition=()=>{jQuery(".condition-field-premium .remove-condition-field").each(function(){jQuery(this).trigger("click")}),jQuery(".condition-notice").remove(),jQuery(".empty-conditions").each(function(){jQuery(this).closest(".condition-group").find(".remove-condition-group").trigger("click")})}}const Gt=(e,t)=>{const{cart_condition_premium_notice:o}=acfw_edit_coupon;if(!o)return{};let n={};for(const[i,c]of Object.entries(t))if(c.type!=="group_logic")for(let[a,s]of Object.entries(c.fields)){let d=Object.entries(e).find(([r,p])=>p.key===s.type);if(d){let[r,p]=d,{label_premium:u}=o;p.title.includes(u)&&(n[r]=p)}}return n},Yt=(e,t)=>{const{cart_condition_premium_notice:o}=acfw_edit_coupon;let n=[],i="";i='<div class="condition-notice">',i+='<a id="remove-all-premium-condition" href="javascript:void(0);" onclick="acfw_edit_coupon_triggers.remove_all_premium_condition()"><i class="dashicons dashicons-trash"></i></a>',i+='<img src="'.concat(o.logo_img,'">');let{label_premium:c}=o;return Object.keys(t).map(a=>{let s=t[a];n.push("<b>".concat(s.title.replace(" (".concat(c,")"),""),"</b>"))}),o.label.map(a=>{a=n.length&&a.includes("{{premium}}")?a.replace("{{premium}}",n.join(", ")):a,i+="<p>".concat(a,"</p>")}),i+='<div class="action-wrap">',o.actions.map(a=>{let s=a.url.includes("action=")?"":"target='_blank'";i+='<a href="'.concat(a.url,'" ').concat(s,' class="action-button primary">').concat(a.label,"</a>")}),i+="</div>",i+="</div>",i};function Zt(e){const{cart_condition_fields:t}=acfw_edit_coupon;let o="";if(e.length){let n=Gt(t,e);Object.keys(n).length&&(o+=Yt(t,n),Bt())}return o}const Ee=jQuery;function Kt(){const e=Ee(this),t=e.closest(".woocommerce").find("#acfw_cart_conditions"),o=e.data("tab");t.find(".panel").hide(),t.find('.panel[data-tab="'.concat(o,'"]')).show(),Xt(e)}function Xt(e){Ee(".acfw-cart-condition-tabs li").removeClass("active"),e.closest("li").addClass("active")}const h=jQuery,v=document.querySelector("#acfw_cart_conditions");function eo(){h(v).on("click","#add-cart-condition-group",ct),h(v).on("click","a.remove-condition-group",at),h(v).on("click",".add-condition-field",kt),h(v).on("click","a.remove-condition-field",Ct),h(v).on("click",".add-condition-trigger",ve),h(v).on("click",".cancel-add-condition-field",ve),h(v).on("click",".acfw-styled-table tfoot .add-table-row",It),h(v).on("click",".acfw-styled-table td.actions a.edit",Nt),h(v).on("click","tr.add-edit-form .actions .condition-product-add",Et),h(v).on("click","tr.add-edit-form .actions .cancel",Ht),h(v).on("click",".acfw-styled-table td.actions a.remove",Vt),h(v).on("click","#save-cart-conditions",Dt),h(v).on("change","input[type='number']",Pt),h(v).on("change","select.condition-select",zt),h(v).on("change","select.has-ordered-before-type",Jt),h(v).on("change",".wc_input_price",Rt),h(v).on("change","select.custom-taxonomy",et),h(v).on("change",".shipping-zone-region-field select.condition-select",tt),h(v).on("blur",".wc_input_price",Ut),h(v).on("change","select.value-type",Wt),h("form#post").on("submit",Lt),h(v).find("select").trigger("change"),h(v).css("min-height",h("#coupon_options").height()),h(v).on("change","input,select,textarea",()=>{O(!0)}),h(v).find(".condition-groups").each(function(){h(this).find(".condition-group-fields").length&&h(this).show()}),h(".acfw-cart-condition-tabs").on("click","li a",Kt),h(v).on("change","input.display-notice-auto-apply-field",ot),h(v).find("input.display-notice-auto-apply-field").trigger("change"),setTimeout(to,500)}function to(){const e=v.querySelector(".condition-groups"),t=h(v).data("cart_conditions");(async()=>{let n="";if(n+=Zt(t),t.length)for(let i of t)if(i.type=="group"){const c=oo(i.fields);n+=ue(c)}else n+=Qe(i.value);else n=ue();h(e).html(n),h(e).find("input,select").trigger("change"),h(e).find(".condition-group.new .add-condition-trigger").trigger("click"),h(e).find(".condition-group").removeClass("new")})().then(()=>{setTimeout(()=>h("body").trigger("wc-enhanced-select-init"),1500),O(!1)})}function oo(e){let t="",o="",n=!0;for(let i of e){const{type:c,data:a}=i;if(!qt(c)){n=!1;continue}if(c=="logic"){o=n?Oe(a):"";continue}const s=Ae(c,a);s?(t+=o+s,n=!0):n=!1,o=""}return t}function ce(){const{upsell:e}=acfw_edit_coupon;return e?'\n  <div class="upsell">\n    '.concat(e.bogo_deals_type,"\n  </div>"):""}function no(e,t=!1){const{products:o,quantity:n,discount_type:i,discount_value:c}=e,{bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{quantity:d,products:r,price_discount:p,type_to_search:u}=a,w=i?e.discount_type:"override",$=t?io(w,c):"",k=t?'<th class="price">'.concat(p,"</th>"):"",D=co(o),A=t?"".concat(s.combination_get," ").concat(s.combination_get_2):s.combination_buy;return'\n      <p class="instructions">'.concat(A,'</p>\n      <table class="acfw-styled-table combined-objects-form" \n          data-combined="').concat(j(JSON.stringify(e)),'"\n          data-isdeals="').concat(t,'"\n          data-type="product">\n          <thead>\n              <tr>\n                  <th class="objects-list">').concat(r,'</th>\n                  <th class="quantity">').concat(d,"</th>\n                  ").concat(k,'\n              </tr>\n          </thead>\n          <tbody>\n              <tr>\n                  <td class="objects-list object">\n                      <select class="combined-products-list wc-product-search"\n                      data-placeholder="').concat(u,'"\n                      data-action="acfw_search_products"\n                      data-exclude="" multiple>').concat(D,'</select>\n                  </td>\n                  <td class="quantity">\n                      <input type="number" class="condition-quantity" value="').concat(n,'" min="1">\n                  </td>\n                  ').concat($,"\n              </tr>\n          </tbody>\n      </table>\n      ").concat(ce(),"\n    ")}function io(e,t="0"){const{currency_symbol:o,discount_field_options:n}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=n;return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(e=="override"?"selected":"",">").concat(o," : ").concat(i,'</option>\n            <option value="percent" ').concat(e=="percent"?"selected":"",">% : ").concat(c,'</option>\n            <option value="fixed" ').concat(e=="fixed"?"selected":"",">-").concat(o," : ").concat(a,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(t,'">\n        </div>\n    </td>\n    ')}function co(e){if(typeof e!="object"||!e.length)return"";let t="";for(let o of e)t+='<option value="'.concat(o.product_id,'" selected>').concat(o.label,"</option>");return t}function ao(e,t=!1){const{categories:o,quantity:n,discount_type:i,discount_value:c}=e,{bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{quantity:d,categories:r,price_discount:p,type_to_search:u}=a,w=i?e.discount_type:"override",$=t?so(w,c):"",k=t?'<th class="price">'.concat(p,"</th>"):"",D=lo(o),A=t?"".concat(s.categories_get):s.categories_buy;return'\n      <p class="instructions">'.concat(A,'</p>\n      <table class="acfw-styled-table combined-objects-form" \n          data-combined="').concat(j(JSON.stringify(e)),'"\n          data-isdeals="').concat(t,'"\n          data-type="category">\n          <thead>\n              <tr>\n                  <th class="objects-list">').concat(r,'</th>\n                  <th class="quantity">').concat(d,"</th>\n                  ").concat(k,'\n              </tr>\n          </thead>\n          <tbody>\n              <tr>\n                  <td class="objects-list object">\n                      <select class="product-categories-list wc-product-search"\n                      data-placeholder="').concat(u,'"\n                      data-action="acfw_search_product_category"\n                      data-exclude="" multiple>').concat(D,'</select>\n                  </td>\n                  <td class="quantity">\n                      <input type="number" class="condition-quantity" value="').concat(n,'" min="1">\n                  </td>\n                  ').concat($,"\n              </tr>\n          </tbody>\n      </table>\n      ").concat(ce(),"\n    ")}function so(e,t="0"){const{currency_symbol:o,discount_field_options:n}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=n;return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(e=="override"?"selected":"",">").concat(o," : ").concat(i,'</option>\n            <option value="percent" ').concat(e=="percent"?"selected":"",">% : ").concat(c,'</option>\n            <option value="fixed" ').concat(e=="fixed"?"selected":"",">-").concat(o," : ").concat(a,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(t,'">\n        </div>\n    </td>\n    ')}function lo(e){if(typeof e!="object"||!e.length)return"";let t="";for(let o of e)t+='<option value="'.concat(o.category_id,'" selected>').concat(o.label,"</option>");return t}function He(e){const{product_id:t,product_label:o}=e;return'\n    <td class="product product-'.concat(t,' object" data-product="').concat(j(JSON.stringify(e)),'">\n        ').concat(o,"\n    </td>\n    ")}function Y(e=3,t="product"){const{no_products_added:o,no_categories_added:n}=acfw_edit_coupon;return'\n    <tr class="no-result">\n        <td colspan="'.concat(e,'">').concat(t=="category"?n:o,"</td>\n    </tr>\n    ")}function ro(e,t,o=!1){const{add_product_label:n,bogo_form_fields:i,bogo_instructions:c}=acfw_edit_coupon,{quantity:a,product:s}=i,d=o?"".concat(c.specific_get):c.specific_buy,r=o?4:3,p=o?'<th class="price">Price/Discount</th>':"";let u="",w=[];if(e.length>=1&&t=="specific-products")for(let k of e){let{quantity:D,discount_type:A,discount_value:P}=k,Z=o?uo(A,P):"";w.push(k.product_id),u+="\n        <tr>\n          ".concat(He(k),'\n          <td class="quantity">').concat(D,"</td>\n          ").concat(Z,'\n          <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n          </td>\n        </tr>\n      ')}else u=Y(r);return'\n    <p class="instructions">'.concat(d,'</p>\n    <table class="product-quantity-condition-table acfw-styled-table" \n      data-type="product" data-exclude="').concat(j(JSON.stringify(w)),'" \n      data-isdeals="').concat(o,'">\n      <thead>\n        <tr>\n          <th class="product">').concat(s,'</th>\n          <th class="quantity">').concat(a,"</th>\n          ").concat(p,'\n          <th class="actions"></th>\n        </tr>\n      </thead>\n      <tbody>').concat(u,'</tbody>\n      <tfoot>\n        <tr>\n          <td colspan="').concat(r,'">\n            <a class="add-table-row" href="javascript:void(0);">\n              <i class="dashicons dashicons-plus"></i>\n              ').concat(n,"\n            </a>\n          </td>\n        </tr>\n      </tfoot>\n    </table>\n  ")}function uo(e="override",t="0"){return'<td class="price">\n    ('.concat(e,") ").concat(t,"\n  </td>")}function po(e,t=!1){return t?fo(e):_o(e)}function _o(e){const{quantity:t}=e,{bogo_instructions:o,bogo_form_fields:n}=acfw_edit_coupon;return'\n    <p class="instructions">'.concat(o.anyproducts_buy,'</p>\n    <div class="any-products-trigger-form any-products-form" data-anyproducts="').concat(j(JSON.stringify(e)),'">\n      <div class="trigger-field-row trigger-quantity-field-row">\n        <label for="any_products_trigger_qty">').concat(n.trigger_quantity,'</label>\n        <input type="number" id="any_products_trigger_qty" class="condition-quantity" value="').concat(t!=null?t:"1",'" min="1" />\n      </div>\n    </div>\n    ').concat(ce(),"\n  ")}function fo(e){const{quantity:t,discount_type:o,discount_value:n}=e,{currency_symbol:i,discount_field_options:c,bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{override:d,percent:r,fixed:p}=c,{quantity:u,price_discount:w,discount_type:$}=a,k=o?e.discount_type:"override";return'\n    <p class="instructions">'.concat(s.anyproducts_get,'</p>\n    <table class="acfw-styled-table any-products-apply-form any-products-form" data-anyproducts="').concat(j(JSON.stringify(e)),'">\n      <thead>\n        <tr>\n          <th class="quantity">').concat(u,'</th>\n          <th class="type">').concat($,'</th>\n          <th class="price">').concat(w,'</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td class="quantity object">\n            <input type="number" class="condition-quantity" value="').concat(t!=null?t:"1",'" min="1">\n          </td>\n          <td class="type">\n            <select class="discount_type">\n              <option value="override" ').concat(k=="override"?"selected":"",">").concat(i," : ").concat(d,'</option>\n              <option value="percent" ').concat(k=="percent"?"selected":"",">% : ").concat(r,'</option>\n              <option value="fixed" ').concat(k=="fixed"?"selected":"",">-").concat(i," : ").concat(p,'</option>\n            </select>\n          </td>\n          <td class="price">\n            <input type="text" class="discount_value short wc_input_price" value="').concat(n!=null?n:"0",'">\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    ').concat(ce(),"\n  ")}const S=jQuery,z=document.querySelector("#acfw_bogo_deals");function M(e){S(z).data("editing",e),S(z).find("#save-bogo-deals").prop("disabled",!e)}function go(e){const t=S(this),o=t.data("block"),n=z.querySelector(".bogo-conditions-block"),i=z.querySelector(".bogo-product-deals-block"),c=S(z).data("bogo_deals"),a=c.conditions?c.conditions:null,s=c.deals?c.deals:null,d=o=="conditions"?c.conditions_type:c.deals_type;let r=null;o==="conditions"?r=c.conditions_type==t.val()?a:r:r=c.deals_type==t.val()?s:r;const p=o=="deals";let u=!1,w,$;switch(t.val()){case"combination-products":w=no(r!=null?r:{},p),u=!0;break;case"product-categories":w=ao(r!=null?r:[],p),u=!0;break;case"any-products":w=po(r!=null?r:{},p),u=!0;break;case"specific-products":default:w=ro(r!=null?r:{},d,p),u=!1;break}if(o=="conditions")S(n).html(w).find("input.condition-quantity").trigger(e.type==="change"?"change":"acfw_fetch_data"),$=n;else{const k=S(z).find(".multiple-items-desc");t.val()!=="specific-products"?k.show():k.hide(),S(i).html(w).find("input.condition-quantity").trigger(e.type==="change"?"change":"acfw_fetch_data"),$=i}u&&acfw_edit_coupon.upsell!==void 0?S($).addClass("premium-only"):S($).removeClass("premium-only"),S("body").trigger("wc-enhanced-select-init"),S("body").trigger("init_tooltips")}function mo(){const e=S(this),t=e.closest("#acfw_bogo_deals");e.val()==="repeat"?(t.find(".repeat-limit-field-wrap").addClass("show"),t.find("#bogo-repeat-limit").prop("disabled",!1)):(t.find(".repeat-limit-field-wrap").removeClass("show"),t.find("#bogo-repeat-limit").prop("disabled",!0))}const m=jQuery,x=document.querySelector("#acfw_bogo_deals"),{post_id:oe}=woocommerce_admin_meta_boxes;function ho(){var P,Z;m("#acfw_bogo_deals").find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click");const{post_status:e,upsell:t}=acfw_edit_coupon,o=x.querySelectorAll(".bogo-conditions-block table.acfw-styled-table tbody td.object,.bogo-conditions-block .any-products-trigger-form"),n=x.querySelectorAll(".bogo-product-deals-block table.acfw-styled-table tbody td.object"),i=x.querySelector(".acfw-overlay"),c=x.querySelector("input[name='bogo_type']:checked"),a=m(x).find("#bogo-condition-type").val(),s=m(x).find("#bogo-deals-type").val(),d=parseInt(m(x).find("#bogo-repeat-limit").val()),r=m(x).find(".notice-option"),p=ke(o,a),u=ke(n,s),w=c?c.value:null;let $=!1,k=!1;if(a==="any-products"&&($=(p==null?void 0:p.quantity)<1),s==="any-products"&&(k=!(u!=null&&u.discount_type)||!(u!=null&&u.discount_value)||(u==null?void 0:u.quantity)<1),a==="combination-products"&&($=!((P=p==null?void 0:p.products)!=null&&P.length)||(p==null?void 0:p.quantity)<1),s==="combination-products"&&(k=!((Z=u==null?void 0:u.products)!=null&&Z.length)||!(u!=null&&u.discount_type)||!(u!=null&&u.discount_value)||(u==null?void 0:u.quantity)<1),(p==null?void 0:p.length)<1||(u==null?void 0:u.length)<1||!w||$||k){vex.dialog.alert(acfw_edit_coupon.bogo_deals_save_error_msg),m(x).addClass("save-error");return}if(t!==void 0&&(a!=="specific-products"||s!=="specific-products")){vex.dialog.alert(acfw_edit_coupon.bogo_deals_save_error_msg),m(x).addClass("save-error");return}if(["any-products","combination-products"].includes(s)&&!Te(u==null?void 0:u.discount_type,u==null?void 0:u.discount_value)){vex.dialog.alert(acfw_edit_coupon.discount_type_value_error_msg),m(x).addClass("save-error");return}const D={message:r.find("textarea[name='acfw_bogo_notice_message_text']").val(),button_text:r.find("input[name='acfw_bogo_notice_button_text']").val(),button_url:r.find("input[name='acfw_bogo_notice_button_url']").val(),notice_type:r.find("select[name='acfw_bogo_notice_type']").val()};H(i,"show"),m(x).trigger("save_bogo_deals");const A={conditions:p,deals:u,conditions_type:a,deals_type:s,repeat_limit:d,type:w,notice_settings:D,nonce:m(x).data("nonce")};m.post(ajaxurl,{action:"acfw_save_bogo_deals",coupon_id:oe,...A},ae=>{ae.status=="success"?(m(x).data("bogo_deals",A),e!=="publish"&&(m("input[name='post_title']").val()||m("input[name='post_title']").val("coupon-"+oe),m("select[name='post_status']").append(new Option("Published","publish")).val("publish"),m("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),m("input#publish").click())):ae.error_msg&&vex.dialog.alert(ae.error_msg),m(x).find("#clear-bogo-deals").prop("disabled",!1),M(!1),H(i,"hide")},"json")}function ke(e,t){let o=[],n;switch(t){case"any-products":o=m(e).closest(".any-products-form").data("anyproducts");break;case"combination-products":case"product-categories":o=m(e).closest("table.combined-objects-form").data("combined");break;case"specific-products":default:e.forEach(i=>{n=jQuery(i).data("product"),n&&o.push(n)});break}return o}function bo(){const e=m(this);if(!confirm(e.data("prompt")))return;const t=x.querySelector(".bogo-conditions-block table.acfw-styled-table tbody"),o=x.querySelector(".bogo-product-deals-block table.acfw-styled-table tbody"),n=x.querySelector(".acfw-overlay"),i=x.querySelector("input[name='bogo_type']:checked");H(n,"show"),m.post(ajaxurl,{action:"acfw_clear_bogo_deals",coupon_id:oe,_wpnonce:e.data("nonce")},c=>{c.status=="success"?(m(t).html(Y(3)),m(o).html(Y(4)),m(i).prop("checked",!1),e.prop("disabled",!0),M(!1),m("#post-status-display").text()!="Published"&&(m("input[name='post_title']").val()||m("input[name='post_title']").val("coupon-"+oe),m("input#publish").click())):c.error_msg&&vex.dialog.alert(c.error_msg),H(n,"hide")},"json")}function vo(){const e=m(this).closest("table.combined-objects-form"),t=e.data("combined"),o=e.find(".wc-product-search option:selected"),n=parseInt(e.find("input.condition-quantity").val()+""),i=e.data("type").toString(),c=i==="category"?{categories:[],quantity:n}:{products:[],quantity:n};if(e.data("isdeals")){const r=e.find("select.discount_type"),p=e.find("input.discount_value"),u=parseFloat(p.val());if(u<0||isNaN(u)){p.val(t?t.discount_value:""),vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}else c.discount_type=r.val(),c.discount_value=p.val()}let s,d;for(d=0;d<o.length;d++)s=m(o[d]),i==="category"?c.categories.push({category_id:s.val(),label:s.text()}):c.products.push({product_id:s.val(),label:s.text()});e.data("combined",c),M(!0)}function yo(e){m(x).data("editing")&&(e.preventDefault(),m(x).find("#save-bogo-deals").trigger("click"),setTimeout(()=>{m(x).hasClass("save-error")?m(x).removeClass("save-error"):m("form#post").submit()},1e3))}function wo(e){const t=m(this).closest(".any-products-trigger-form"),o=parseInt(t.find("input#any_products_trigger_qty").val()),n={quantity:o&&!isNaN(o)?o:0};t.data("anyproducts",n),e.type==="change"&&M(!0)}function $o(e){const t=m(this).closest(".any-products-apply-form"),o=parseInt(t.find("input.condition-quantity").val()),n=t.find("select.discount_type").val().toString(),i=t.find("input.discount_value").val().toString(),c={quantity:o&&!isNaN(o)?o:0,discount_type:n!=null?n:"",discount_value:i!=null?i:""};t.data("anyproducts",c),e.type==="change"&&M(!0)}function Ve(e,t,o,n=!1){const{type_to_search:i}=acfw_edit_coupon.bogo_form_fields,{add:c,edit:a,cancel:s}=acfw_edit_coupon.product_table_buttons,{quantity:d}=n,r=typeof n=="object"?xo(e,n):"",p=o?ko(n):"",u=typeof n=="object"?a:c;return t=o?[...t,"product_type_gift_card"]:t,'\n    <tr class="add-edit-form adding">\n        <td class="product" data-object="'.concat(typeof n=="object"?j(JSON.stringify(n)):0,'">\n            <div class="object-search-wrap">\n                <select class="').concat(e=="category"?"product-category-in-cart":"product-in-cart",' wc-product-search"\n                    data-placeholder="').concat(i,'"\n                    data-action="').concat(e=="category"?"acfw_search_product_category":"acfw_search_products",'"\n                    data-exclude="').concat(j(JSON.stringify(t)),'">').concat(r,'</select>\n            </div>\n        </td>\n        <td class="quantity">\n            <input type="number" class="condition-quantity" value="').concat(typeof n=="object"?d:1,'" min="1">\n        </td>\n        ').concat(p,'\n        <td class="actions">\n            <button type="button" class="condition-product-add button-primary">').concat(u,'</button>\n            <button type="button" class="cancel button">').concat(s,"</button>\n        </td>\n    </tr>\n    ")}function xo(e,t){const{category_id:o,product_id:n,category_label:i,product_label:c}=t,a=e=="category"?o:n,s=e=="category"?i:c;return'<option value="'.concat(a,'">').concat(s,"</option>")}function ko(e){const{currency_symbol:t,discount_field_options:o}=acfw_edit_coupon,{override:n,percent:i,fixed:c}=o,{discount_type:a,discount_value:s}=e,d=typeof e=="object"&&s?s:"0";return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(a=="override"?"selected":"",">").concat(t," : ").concat(n,'</option>\n            <option value="percent" ').concat(a=="percent"?"selected":"",">% : ").concat(i,'</option>\n            <option value="fixed" ').concat(a=="fixed"?"selected":"",">-").concat(t," : ").concat(c,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(d,'">\n        </div>\n    </td>\n    ')}function Co(e){const{category_id:t,category_label:o}=e;return'\n    <td class="category category-'.concat(t,' object" data-category="').concat(j(JSON.stringify(e)),'">\n        ').concat(o,"\n    </td>\n    ")}function Pe(e,t,o){const{quantity:n,discount_type:i,discount_value:c}=e,a=o?'<td class="price">('.concat(i,") ").concat(c,"</td>"):"";return"\n    <tr>\n      ".concat(qo(e,t),'\n      <td class="quantity">').concat(n,"</td>\n      ").concat(a,'\n      <td class="actions">\n        <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n        <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n      </td>\n    </tr>')}function qo(e,t){switch(t){case"category":return Co(e);case"product":return He(e)}return""}const J=jQuery;acfw_edit_coupon;function Fo(){const e=J(this),t=e.closest(".acfw-styled-table"),o=t.find("tbody"),n=t.data("isdeals"),i=t.data("type"),c=t.data("exclude");o.find("tr.no-result").remove(),o.append(Ve(i,c,n)),J("body").trigger("wc-enhanced-select-init"),o.find("tr.add-edit-form select.enhanced").trigger("focus")}function jo(){const e=jQuery(this),t=e.closest("tr"),o=e.closest(".acfw-styled-table"),n=o.find("tbody"),i=o.data("isdeals"),c=o.data("type"),a=t.find(".object").data(c),{category_id:s,product_id:d}=a,r=o.data("exclude"),p=c=="category"?s:d;r.splice(r.indexOf(p),1),n.find("tr.no-result").remove(),t.replaceWith(Ve(c,r,i,a)),o.data("exclude",r),o.find(".wc-product-search").data("exclude",r),J("body").trigger("wc-enhanced-select-init")}function So(){const e=J(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=o.data("isdeals"),c=t.find("td").length,a=o.data("type"),s=t.find("td.product").data("object"),{category_id:d,product_id:r}=s,p=o.data("exclude"),u=a=="category"?d:r;if(p.includes(u)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}typeof s=="object"?(p.push(u),t.replaceWith(Pe(s,a,i)),o.data("exclude",p),o.find(".wc-product-search").data("exclude",p)):(t.remove(),n.find("tr").length<=0&&n.append(Y(c,a)))}function Do(){const e=J(this),t=e.closest("tr"),o=e.closest("table.acfw-styled-table"),n=o.data("isdeals"),i=o.data("type"),c=t.find(".wc-product-search"),a=t.find(".condition-quantity"),s=o.data("exclude");if(!c.val()||!a.val()||a.val()<1){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}if(s.includes(parseInt(c.val()))){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}if(n){const u=t.find("input.discount_value").val();if(!Te(t.find("select.discount_type").val(),u)){vex.dialog.alert(acfw_edit_coupon.discount_type_value_error_msg);return}if(re(u)<0||isNaN(re(u))){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}}const d=To(t,i,n),{category_id:r,product_id:p}=d;s.push(i=="category"?r:p),t.replaceWith(Pe(d,i,n)),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),M(!0)}function Lo(){const e=J(this),t=e.closest("tr"),o=t.closest("table"),n=t.closest("tbody"),i=t.find("td").length,c=o.data("type"),a=t.find("td.object").data(c),s=o.data("exclude");let d;switch(c){case"category":d=s.indexOf(parseInt(a.category_id));break;case"product":default:d=s.indexOf(parseInt(a.product_id));break}d!==-1&&s.splice(d,1),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),t.remove(),n.find("tr").length<=0&&n.append(Y(i,c)),M(!0)}function To(e,t,o){let n={};return t=="category"?n={category_id:parseInt(e.find(".wc-product-search").val()+""),quantity:parseInt(e.find(".condition-quantity").val()+""),category_label:e.find(".wc-product-search option:selected").text()}:n={product_id:parseInt(e.find(".wc-product-search").val()+""),quantity:parseInt(e.find(".condition-quantity").val()+""),product_label:e.find(".wc-product-search option:selected").text()},o&&(n.discount_type=e.find("select.discount_type").val(),n.discount_value=e.find("input.discount_value").val()),n}const b=jQuery,C=document.querySelector("#acfw_bogo_deals");acfw_edit_coupon={...acfw_edit_coupon,bogo_toggle_editing_mode:M};function Qo(){b(C).on("click",".acfw-styled-table tfoot .add-table-row",Fo),b(C).on("click",".acfw-styled-table td.actions a.edit",jo),b(C).on("click","tr.add-edit-form .actions .cancel",So),b(C).on("click","tr.add-edit-form .actions .condition-product-add",Do),b(C).on("click",".acfw-styled-table td.actions a.remove",Lo),b(C).on("click","button#save-bogo-deals",ho),b(C).on("click","button#clear-bogo-deals",bo),b(C).on("change acfw_load","select#bogo-condition-type,select#bogo-deals-type",go),b(C).on("change acfw_fetch_data",".combined-objects-form select,.combined-objects-form input",vo),b(C).on("change acfw_fetch_data",".any-products-trigger-form input",wo),b(C).on("change acfw_fetch_data",".any-products-apply-form input,.any-products-apply-form select",$o),b(C).on("change",".condition-quantity",Mo),b(C).on("blur",".wc_input_price",nt),b(C).css("min-height",b("#coupon_options").height()),b(C).on("change","input[name='bogo_type']",K),b(C).on("change acfw_load","input[name='bogo_type']",mo),b(C).on("change","#bogo-repeat-limit",K),b(C).on("click",".acfw-styled-table .actions .remove",K),b(C).find(".notice-option").on("change","input,textarea,select",K),b("form#post").on("submit",yo),b(C).find("select#bogo-condition-type,select#bogo-deals-type").trigger("acfw_load"),b("#woocommerce-coupon-data").on("change acfw_load","select#discount_type",Oo),b("#woocommerce-coupon-data select#discount_type").trigger("acfw_load"),b(C).find("input[name='bogo_type']:checked").trigger("acfw_load")}function Oo(){const e=b(this),t=e.closest("#general_coupon_data"),o=t.find("p.form-field input");if(e.val()==="acfw_bogo"){t.addClass("acfw-bogo-type"),b("#acfw_bogo_deals").show();for(let n=0;n<=o.length;n++)["expiry_date","_acfw_coupon_sort_priority","_acfw_show_on_my_coupons_page","_acfw_force_apply_url_coupon","_acfw_coupon_label","coupon_amount"].includes(b(o[n]).prop("name"))||b(o[n]).prop("disabled",!0)}else{t.removeClass("acfw-bogo-type"),b("#acfw_bogo_deals").hide();for(let n=0;n<=o.length;n++)["expiry_date","_acfw_coupon_sort_priority","coupon_amount"].includes(b(o[n]).prop("name"))||b(o[n]).prop("disabled",!1)}}function K(){M(!0)}function Mo(){const e=jQuery(this);e.val()<1&&e.val(1)}var ze=jQuery;function Ao(){const e=ze(".toggle-enable-fields");e.on("change",".toggle-trigger-field",Io),e.find(".toggle-trigger-field").trigger("change")}function Io(){const e=ze(this),t=e.closest(".toggle-enable-fields"),o=t.find("select,textarea,input:not(.toggle-trigger-field)"),n=!e.prop("checked");o.prop("disabled",n),n?o.closest(".form-field").addClass("disabled"):o.closest(".form-field").removeClass("disabled")}var F=jQuery;function No(){const e=document.querySelector("#acfw_url_coupon");F(e).on("click",".copy-coupon-url",Ho),Eo(),typeof ACFW_QRCode<"u"&&Vo()}function Eo(){F("input#_acfw_coupon_url").after('<button type="button" class="copy-coupon-url" data-clipboard-target="#_acfw_coupon_url">\n    <svg width="15" height="15" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 460 460" style="enable-background:new 0 0 460 460;" xml:space="preserve">\n      <g>\n        <path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272\n          c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729\n          c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"/>\n        <path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272\n          c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068\n          c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001\n          C291.206,428.715,289.92,430,288.341,430z"/>\n      </g>\n    </svg>\n    </button>'),new ClipboardJS(".copy-coupon-url")}function Ho(){F(this).after('<span class="coupon-url-copied">'.concat(acfw_edit_coupon.copied_label,"</span>")),setTimeout(()=>{F("span.coupon-url-copied").fadeOut(500)},1e3)}function Vo(){F("#acfw_url_coupon").find(".options_group").prepend('<div class="acfw-qr-code-container">\n        <div id="acfw-qr-code"></div>\n        <a id="acfw-download-qr-link" href="#">'.concat(acfw_edit_coupon.download_qr_image_label,"</a>\n    </div>")),Po()}function Po(){var e=F("input#_acfw_coupon_url").val(),t=F("#acfw-download-qr-link");if(e){let o=F("#acfw-qr-code");try{new ACFW_QRCode(o[0],{text:e,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:ACFW_QRCode.CorrectLevel.L}).makeCode(e),t.click(function(){var i=F("#acfw-qr-code img"),c=i.attr("src");t.attr("href",c),t.attr("download","".concat(F("#title").val(),".png"))})}catch(n){F("#acfw-qr-code").remove(),F("#acfw-download-qr-link").addClass("disabled"),F("#acfw-download-qr-link").before('<p class="error-message">'.concat(acfw_edit_coupon.error_generate_qr_image,"</p>"))}}else F(".acfw-qr-code-container").hide()}const y=jQuery;function zo(){const e=document.querySelector("#acfw_scheduler"),t=e.querySelector("#_acfw_schedule_start"),o=e.querySelector("#_acfw_schedule_expire"),n=document.querySelector("#general_coupon_data p.expiry_date_field");y(e).on("change",".date-field,.date-hour,.date-minute",Uo),y(e).on("click",".clear-scheduler-fields",Wo),y(n).css("display","none"),y(t).trigger("change acfw_load"),y(o).trigger("change acfw_load"),y(e).on("change acfw_load",".acfw-section-toggle input",Bo),y(e).find(".acfw-section-toggle input").trigger("acfw_load"),y(".wrap").on("submit","form#post",Ro),Jo()}function Jo(){var i,c;const e=document.querySelector("#_acfw_schedule_start"),t=document.querySelector("#_acfw_schedule_expire"),o=(i=flatpickr.parseDate(t.value,"Y-m-d H:i:S"))!=null?i:null,n=(c=flatpickr.parseDate(e.value,"Y-m-d H:i:S"))!=null?c:null;o&&o.setMinutes(o.getMinutes()-1),n&&n.setMinutes(n.getMinutes()+1),y(e).flatpickr({allowInput:!0,enableTime:!0,altInput:!0,allowInvalidPreload:!0,altFormat:"Y-m-d h:i K",dateFormat:"Y-m-d H:i:S",maxDate:o,onChange:function([a],s,d){a?(a.setMinutes(a.getMinutes()+1),t._flatpickr.set("minDate",a),Ce()):t._flatpickr.set("minDate",null)}}),y(t).flatpickr({allowInput:!0,enableTime:!0,altInput:!0,altFormat:"Y-m-d h:i K",dateFormat:"Y-m-d H:i:S",minDate:n,onChange:function([a],s,d){a?(a.setMinutes(a.getMinutes()-1),e._flatpickr.set("maxDate",a),Ce()):e._flatpickr.set("maxDate",null)}})}function Ce(){const e=flatpickr.parseDate(y("#_acfw_schedule_start").val(),"Y-m-d H:i:S"),t=flatpickr.parseDate(y("#_acfw_schedule_expire").val(),"Y-m-d H:i:S");e>=t?(y("#_acfw_schedule_start").parent().addClass("error"),y("#_acfw_schedule_expire").parent().addClass("error")):(y("#_acfw_schedule_start").parent().removeClass("error"),y("#_acfw_schedule_expire").parent().removeClass("error"))}function Ro(e){y(".acfw-date-range-schedules-section span.date-time-field").hasClass("error")&&(e.preventDefault(),vex.dialog.alert({unsafeMessage:acfw_edit_coupon.invalid_scheduler_time}),y("#publishing-action .spinner").removeClass("is-active"),y("#publishing-action #publish").removeClass("disabled"))}function Uo(){const e=y(this).closest(".date-time-field"),t=e.find(".date-field");t.val()?t.prop("required",!0):t.prop("required",!1)}function Wo(){const e=document.querySelector("#acfw_scheduler"),t=e.querySelector("#_acfw_schedule_start"),o=e.querySelector("#_acfw_schedule_expire"),n=y(this).siblings(".date-time-field");n.find("input").prop("required",!1).val(""),n.find("input")[0]._flatpickr.clear(),y(t).trigger("change"),y(o).trigger("change")}function Bo(){const e=y(this),o=e.closest(".acfw-scheduler-section").find(".options_group");e.is(":checked")?(o.removeClass("disabled"),o.find(".date-field,.days-time-field label input,textarea").prop("disabled",!1),y("#acfw_scheduler .options_group input").trigger("acfw_load")):(o.addClass("disabled"),o.find(".date-field,.days-time-field label input,textarea").prop("disabled",!0)),o.find("input").trigger("change")}const f=jQuery;let se=!1;function Go(){f("#usage_limit_coupon_data").on("change","#reset_usage_limit_period",Zo),f("#usage_restriction_coupon_data .acfw_exclude_coupons_field,\n    #usage_restriction_coupon_data .acfw_allowed_customers_field,\n    #usage_restriction_coupon_data .acfw_allowed_coupons_field,\n    #usage_restriction_coupon_data .acfw_product_attributes_field,\n    #usage_restriction_coupon_data .acfw_exclude_product_attributes_field,\n    #usage_restriction_coupon_data .acfw_disallowed_emails_field,\n    #usage_restriction_coupon_data .acfw_disallowed_customers_field").on("click change focus","input,select",Ko),f("#acfw-auto-apply-coupon").on("change","#acfw_auto_apply_coupon_field",Xo),f("#acfw-virtual-coupon").on("change","#acfw_enable_virtual_coupons",en),f("#acfw_url_coupon").on("change","#acfw_defer_apply_url_coupon",tn),f("#acfw_cart_conditions").on("change",".condition-types",on),f("#woocommerce-coupon-data").on("change acfw_load","#discount_type",nn),f("#woocommerce-coupon-data").on("change acfw_load","#discount_type",an),f("#woocommerce-coupon-data").on("focusin","#discount_type",cn),f("#acfw_bogo_deals").on("change acfw_load","select#bogo-deals-type",sn),f("#acfw_bogo_deals").on("change","input[name='acfw_bogo_auto_add_products']",ln),f("#acfw_bogo_deals").on("change acfw_load","select#bogo-deals-type",dn),f("#acfw_bogo_deals").on("change",'select[name="acfw_bogo_discount_order"]',rn),f("#acfw_scheduler").on("change",".acfw-daytime-schedules-section .acfw-section-toggle input[type='checkbox']",un),f("body").on("change acfw_load","input#individual_use",_n),f("#woocommerce-coupon-data #discount_type").trigger("acfw_load"),Yo(),pn(),fn()}function Yo(){f("p.acfw_exclude_coupons_field").insertAfter("p.form-field.individual_use_field")}function Zo(){const{usage_limits:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(e,"</div>")}),f(this).val("none")}function Ko(){if(se)return;se=!0;const{usage_restriction:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert exclude-coupon">'.concat(e,"</div>"),afterClose:()=>se=!1}),f(this).val("").blur()}function Xo(){const{auto_apply:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert auto-apply">'.concat(e,"</div>")}),f(this).prop("checked",!1)}function en(){const{virtual_coupons:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert auto-apply">'.concat(e,"</div>")}),f(this).prop("checked",!1)}function tn(){const{defer_apply_url_coupon:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert defer-apply">'.concat(e,"</div>")}),f(this).prop("checked",!1)}function on(){const e=f(this),t=e.closest("#acfw_cart_conditions"),o=e.closest(".add-condition-form"),n=t.data("premium-conditions"),i=t.find(".acfw-dyk-notice-holder");let c=o.find(".acfw-dyk-notice");c.length||(o.append(i.html()),c=o.find(".acfw-dyk-notice")),f.inArray(e.val(),n)>=0?c.show():c.hide()}function nn(){f(this).val()==="acfw_bogo"?f("p.acfw-dyk-notice-general").hide():f("p.acfw-dyk-notice-general").show()}function cn(){f(this).data("cachedval",f(this).val())}function an(){var o;const e=f(this).val(),{cashback_coupon:t}=acfw_edit_coupon.upsell;(e==="acfw_percentage_cashback"||e==="acfw_fixed_cashback")&&(vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),f(this).val((o=f(this).data("cachedval"))!=null?o:"percent"))}function sn(){const e=f(this),o=e.closest("#acfw_bogo_deals").find(".bogo-auto-add-products-field"),n=o.find("input[type='checkbox']");e.val()==="specific-products"?(n.prop("disabled",!1),o.addClass("show")):(n.prop("disabled",!1),o.removeClass("show"))}function ln(){f(this).prop("checked",!1);const{bogo_auto_add_get_products:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),f(this).val("none")}function dn(){const e=f(this),o=e.closest("#acfw_bogo_deals").find(".bogo-discount-order-field"),n=o.find("select");e.val()==="specific-products"?(n.prop("disabled",!1),o.addClass("show")):(n.prop("disabled",!1),o.removeClass("show"))}function rn(){f(this).val("none");const{bogo_discount_order:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),f(this).val("none")}function un(){const e=f(this),{day_time_schedules:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert day-time-schedules">'.concat(t,"</div>")}),e.prop("checked",!1).trigger("acfw_load")}function pn(){const e=f("p.acfw_allowed_coupons_field");e.insertAfter("p.form-field.individual_use_field"),e.addClass("hidden")}function _n(){const e=f(this),t=f(".acfw_allowed_coupons_field"),o=t.find("select");e.is(":checked")?(o.prop("disabled",!1),t.show()):(o.prop("disabled",!0),t.hide())}function fn(){const e=jQuery("p.acfw_product_attributes_field"),t=jQuery("p.acfw_exclude_product_attributes_field"),o=jQuery('label[for="exclude_product_categories"]').closest("div.options_group"),n=jQuery('<div class="options_group"></div>');n.append(e),n.append(t),n.insertAfter(o)}const gn=jQuery;function mn(){hn()}function hn(){const e=gn("p._acfw_exclude_wholesale_items_field");e&&e.insertAfter("p.form-field.exclude_sale_items_field")}function bn(e){const{slug:t,action:o,placeholder:n}=e;return'\n    <div class="search-widget search-'.concat(t,'">\n      <input class="search-input" type="text" placeholder="').concat(n,'" data-action="').concat(o,'" />\n      <button type="button" class="clear-search dashicons-before dashicons-no-alt"></button>\n      <div class="search-results"></div>\n    </div>\n  ')}function vn(e,t){const o=e.map(({url:n,title:i})=>'<li><a href="'.concat(yn(n,t),'" rel="noopener noreferrer nofollow" target="_blank">').concat(i,"</a></li>")).join("");return"<ul>".concat(o,"</ul>")}function yn(e,t){return"".concat(e,"?utm_source=acfwf&utm_medium=help_modal&utm_campaign=kb_search&utm_term=").concat(t)}function le(e){const{title:t,className:o}=e;let{links:n}=e;const{is_premium:i}=acfw_edit_coupon.help_modal;return i&&(n=n.filter(c=>(c==null?void 0:c.freeOnly)===void 0||!(c!=null&&c.freeOnly))),'\n    <div class="links-list '.concat(o,'">\n      <h3>').concat(t,"</h3>\n\n      ").concat(e!=null&&e.search?bn(e==null?void 0:e.search):"","\n\n      <ul>\n        ").concat(n.map(c=>"<li>".concat(wn(c),"</li>")).join(""),"\n      </ul>\n    </div>\n  ")}function wn(e){const{title:t,url:o}=e,{is_premium:n}=acfw_edit_coupon.help_modal;return'<a href="'.concat(n&&(e!=null&&e.premiumUrl)?e==null?void 0:e.premiumUrl:o,'">').concat(t,"</a>")}function qe(e){const{labels:t,images_url:o,is_premium:n,link_logo:i,link_upgrade:c}=acfw_edit_coupon.help_modal,{target:a,left:{title:s,content:d,videos:r},right:{links:p,kbs:u,tutorials:w}}=e,$={slug:"kb-articles",action:"acfw_search_help_kb_articles",placeholder:t.search_placeholder},k="".concat(c,"&utm_campaign=help_modal_").concat(a,"_upgrade_link"),D="".concat(i,"&utm_campaign=help_brand_link_").concat(a);return'\n    <div class="header">\n      <div class="logo">\n        <a href="'.concat(D,'" target="_blank"><img src="').concat(o,'acfw-logo.png" alt="Advanced Coupons logo" /></a>\n      </div>\n      ').concat(n?"":'\n        <div class="upgrade-link">\n          <a href="'.concat(k,'" target="_blank">\n            <span>').concat(t.upgrade_to_premium,'</span>\n            <i class="dashicons dashicons-external"></i>\n          </a>\n        </div>\n      '),'\n    </div>\n    <main>\n      <h1 class="title">').concat(s,'</h1>\n      <div class="content">\n        ').concat(d,"\n      </div>\n      ").concat(r.length?'<div class="video-gallery-placeholder"><img src="'.concat(o,'spinner-2x.gif" alt="Loading videos" /><p>').concat(t.loading_videos,"</p></div>"):"","\n    </main>\n    <aside>\n      ").concat(le({title:t.rel_links,className:"relevant-links",links:p}),"\n      ").concat(le({title:t.kb_articles,className:"knowledge-base-articles",links:u,search:$}),"\n      ").concat(le({title:t.tut_guides,className:"tutorials-guides",links:w}),"\n    </aside>\n  ")}function $n(e){const{errorMsg:t}=e;return'\n    <div class="acfw-help-modal-error">\n      <p>'.concat(t,"</p>\n    </div>\n  ")}function xn(e){const{images_url:t}=acfw_edit_coupon.help_modal,{permission_request:o,allow:n,cancel:i}=acfw_edit_coupon.help_modal.labels;return'\n  <div id="acfw-help-modal-permission-request" data-module="'.concat(e,'">\n    <img src="').concat(t,'acfw-logo.png" />\n    <p>').concat(o,'</p>\n    <p class="actions">\n      <button class="button-primary allow" type="button">').concat(n,'</button>\n      <button class="button cancel" type="button">').concat(i,"</button>\n    </p>\n  </div>\n  ")}function Je(){const{images_url:e,labels:t}=acfw_edit_coupon.help_modal;return'<div id="acfw-help-modal-placeholder">\n    <img src="'.concat(e,'spinner-2x.gif" />\n    <p>').concat(t.loading_content,"</p>\n  </div>")}function kn(e){return'\n  <div class="acfw-help-video-gallery">\n    <div class="videos">\n      '.concat(e[0].embed?e[0].embed:Re(e[0]),"\n    </div>\n    ").concat(e.length>1?'\n      <ul class="thumbnails">\n        '.concat(e.map((t,o)=>"\n            <li ".concat(o===0?'class="active"':"",'>\n              <a href="javascript:void(0);" data-videoid="').concat(t.videoid,'">\n                <img src="').concat(t.thumbnail,'" title="').concat(t.title,'" />\n              </a>\n              <span class="title">').concat(t.title,"</span>\n            </li>\n            ")).join(""),"\n      </ul>\n      "):"","\n    \n  </div>\n  ")}function Re(e){return'\n  <div class="no-video" style="background-image:url('.concat(e.thumbnail,');">\n    <a href="').concat(e.url,'" rel="noreferer noopener" >\n      <span>').concat(acfw_edit_coupon.help_modal.labels.no_video,"</span>\n    </a>\n  </div>\n  ")}const _e=jQuery;let V=[],Ue="";function We(e,t){const{_secure_nonce:o}=acfw_edit_coupon.help_modal;e.length&&_e.post(ajaxurl,{action:"acfw_get_help_videos_oembed",urls:e.map(n=>n.url),width:_e(".acfw-help-vex .vex-content main").width(),_nonce:o},n=>{n=n.map(i=>{const c=e.findIndex(a=>a.url===i.url);return i.title=c>=0?e[c].title:"",i}),V=n,Ue=t,Be(n)},"json")}function Cn(e,t){if(!V.length||t!==Ue){We(e,t);return}Be(V)}function Be(e){const t=_e(".acfw-help-vex .video-gallery-placeholder");t.length&&t.replaceWith(kn(e))}function qn(){const e=jQuery(this),t=e.closest("li"),o=e.closest(".acfw-help-video-gallery"),n=o.find(".videos"),i=o.find("ul.thumbnails li"),c=e.data("videoid");if(t.hasClass("active"))return;i.removeClass("active"),t.addClass("active");const a=V.findIndex(s=>s.videoid===c);a>=0&&n.html(V[a].embed?V[a].embed.replace("oembed","oembed&autoplay=1"):Re(V[a]))}const ne=jQuery,fe=[];function Fn(){const{allow_fetch:e}=acfw_edit_coupon.help_modal,o=ne(this).closest(".acfw-help-link").data("module");vex.dialog.open({unsafeMessage:'\n      <a class="vex-close" href="javascript:void(0);"></a>\n      '.concat(e?Je():xn(o),"\n    "),className:"vex-theme-plain acfw-help-vex",showCloseButton:!1,buttons:{}}),e&&Ge(o)}function de(e){const t=ne("#acfw-help-modal-placeholder");t.length&&(t.replaceWith(e),ne(".acfw-help-vex").find("main a,aside a").attr("target","_blank").attr("rel","noopener noreferrer nofollow"))}function Ge(e){const{_secure_nonce:t}=acfw_edit_coupon.help_modal;let o=null;if(o=jn(e)){de(qe(o)),Cn(o.left.videos,e);return}ne.post(ajaxurl,{action:"acfw_fetch_help_data",module:e,_nonce:t},n=>{fe.push(n),de(qe(n)),We(n.left.videos,e)},"json").fail(n=>{de($n(n.responseJSON))})}function jn(e){const t=fe.findIndex(o=>o.target===e);return t>=0?fe[t]:null}const he=jQuery;let E=null,U=null;function Sn(){const t=he(this).closest(".search-widget"),o=t.find("input.search-input"),n=t.find(".search-results"),{labels:i,images_url:c,_secure_nonce:a}=acfw_edit_coupon.help_modal,s=o.val();if(!s){clearTimeout(E),E=null,n.height(0).html(""),t.removeClass("show-clear");return}t.addClass("show-clear"),Dn({action:o.data("action"),term:o.val(),_nonce:a},()=>{n.height(35).html('<div class="loading"><img src="'.concat(c,'spinner.gif" /></div>'))},d=>{t.hasClass("show-clear")&&(d.length?(U={term:s,results:d},n.html(vn(d,s))):n.html('<div class="no-result">'.concat(i.search_no_results,"</div>")),n.height(n.find("ul,.no-result").height()+3))})}function Dn(e,t,o){if(E&&(clearTimeout(E),E=null),e.term===(U==null?void 0:U.term)){o(U.results);return}E=setTimeout(()=>{t(),he.post(ajaxurl,e,o,"json")},1e3)}function Ln(){const t=he(this).closest(".search-widget"),o=t.find("input.search-input"),n=t.find(".search-results");clearTimeout(E),E=null,o.val(""),n.height(0).html(""),t.removeClass("show-clear")}const Tn=jQuery;function Qn(){const{_secure_nonce:e}=acfw_edit_coupon.help_modal,o=jQuery(this).closest("#acfw-help-modal-permission-request"),n=o.data("module");o.replaceWith(Je()),Tn.post(ajaxurl,{action:"acfw_save_fetch_help_permission",_nonce:e},()=>{Ge(n),acfw_edit_coupon.help_modal.allow_fetch=!0},"json")}function On(){vex.closeAll()}const N=jQuery;function Mn(){N("#post-body").on("click",".acfw-help-modal-trigger",Fn),N("body").on("click",".acfw-help-vex .vex-close",()=>vex.closeAll()),N("body").on("click",".acfw-help-vex .acfw-help-video-gallery ul.thumbnails li a",qn),N("body").on("keyup",".acfw-help-vex .search-widget input.search-input",Sn),N("body").on("click",".acfw-help-vex .search-widget button.clear-search",Ln),N("body").on("click",".acfw-help-vex #acfw-help-modal-permission-request button.allow",Qn),N("body").on("click",".acfw-help-vex #acfw-help-modal-permission-request button.cancel",On)}function An(){const e=document.querySelectorAll("#post-body .acfw-help-link"),{help_text:t,images_url:o}=acfw_edit_coupon.help_modal;e.forEach(n=>{const i='\n      <a class="acfw-help-modal-trigger" href="javascript:void(0);">'.concat(t,' \n        <img class="acfw-icon" src="').concat(o,'help-icon.svg" alt="').concat(t,'" />\n      </a>\n    ');N(n).html(i)})}const{labels:g}=acfw_edit_coupon.send_coupon;function In(){return'<button type="button" class="button acfw-send-coupon-btn">'.concat(g.title,"</button>")}const Fe=jQuery,l=new Map;function Ye(e="send_coupon_to",t="email"){l.set("section",e),l.set("option",t),l.set("send_to",t==="pushengage"?"segments":t==="user"?"user":""),l.set("user_id","0"),l.set("name",""),l.set("email",""),l.set("create_account",""),l.set("segment_ids","0"),l.set("subscriber_ids","0"),l.set("segments",g.pushengage.segment_placeholder),l.set("subscribers",""),l.set("title",acfw_edit_coupon.send_coupon.pushengage.default_content.title),l.set("message",acfw_edit_coupon.send_coupon.pushengage.default_content.message),l.set("url",acfw_edit_coupon.send_coupon.pushengage.default_content.url)}function je(){const e=Fe(this),t=e.data("key");let o=e.val()?e.val().toString():"";switch(t){case"option":l.set("option",o);break;case"user":const n=e.find("option:selected");l.set("user_id",o),l.set("name",lodash.first(n.text().split(" ("))),l.set("email",lodash.last(n.text().split("&ndash; ")).replace(")",""));break;case"email":e.removeClass("error"),it(o)||o===""?(l.set(t,o),l.set("user_id","0")):(l.set(t,""),e.addClass("error"));break;case"create_account":o=e.is(":checked")?o:"",l.set(t,o);break;case"url":e.removeClass("error"),Le(o)||o===""?l.set(t,o):(l.set(t,""),e.addClass("error"));break;case"segments":o==="create_new_segment"&&(e.val(null).trigger("change"),window.location.href=acfw_edit_coupon.send_coupon.pushengage_segment_page),o||(o="0-".concat(g.pushengage.segment_placeholder));const i=o.split(","),c=i.map(p=>{const[u]=p.split("-");return u}),a=i.map(p=>p.split("-").slice(1).join("-"));l.set("segment_ids",c),l.set("segments",a);break;case"subscribers":const s=o?o.toString().split(","):[];l.set("subscriber_ids",s);const d=e.find("option:selected"),r=Array.from(d).map(p=>Fe(p).text());l.set("subscribers",r),l.get("subscribers");break;default:l.set(t,o)}W("confirm_and_send")}function Nn(){return'\n  <div class="acfw-send-coupon-form-section '.concat(l.get("section")==="send_coupon_to"?"current":"",'" data-section="send_coupon_to">\n    <div class="section-number">\n      <span>1</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(g.send_coupon_to,'</h3>\n      <div class="section-content">\n        ').concat(En(l.get("option")),'\n        <button type="button" class="button-primary acfw-next-section-btn" style="margin-top: 10px" data-next_section="customer_details">').concat(g.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}function En(e){switch(e){case"email":return'<label>\n          <input type="radio" name="acfw_send_coupon[to]" value="user" data-key="send_to" checked />\n           <span>'.concat(g.email.existing_customer_account,'<span>\n        </label>\n        <label>\n          <input type="radio" name="acfw_send_coupon[to]" value="email" data-key="send_to" />\n           <span>').concat(g.email.new_customer,"<span>\n        </label>");case"pushengage":return'<label>\n        <input type="radio" name="acfw_send_coupon[to]" value="segments" data-key="send_to" checked />\n        <span>'.concat(g.pushengage.segments,'<span>\n      </label>\n      <label>\n        <input type="radio" name="acfw_send_coupon[to]" value="subscribers" data-key="send_to" />\n        <span>').concat(g.pushengage.subscribers,"<span>\n      </label>")}return""}function Hn(){return'\n  <div class="acfw-send-coupon-form-section '.concat(l.get("section")==="customer_details"?"current":"",'" data-section="customer_details">\n    <div class="section-number">\n      <span>2</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(Vn(l.get("option")),'</h3>\n      <div class="section-content">\n        ').concat(Pn(l.get("option")),'\n        <button type="button" class="button-primary acfw-next-section-btn" data-next_section="').concat(l.get("option")==="pushengage"?"message_details":"confirm_and_send",'">').concat(g.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}function Vn(e){switch(e){case"email":return g.email.customer_details;case"pushengage":return g.pushengage.customer_details}return""}function Pn(e){switch(e){case"email":return'<div class="customer-details-form user-form show">\n          <select data-placeholder="'.concat(g.email.search,'" name="acfw_send_coupon[user]" data-key="user" class="wc-customer-search" style="width:100%"></select>\n        </div>\n        <div class="customer-details-form guest-form">\n          <input type="text" placeholder="').concat(g.email.name,'" name="acfw_send_coupon[name]" data-key="name" />\n          <input type="email" placeholder="').concat(g.email.email,'" name="acfw_send_coupon[email]" data-key="email" />\n          <label>\n            <input type="checkbox" data-key="create_account" value="yes" /> \n            <span>').concat(g.email.create_new_user_account,"</span>\n        </div>");case"pushengage":return'\n        <div class="customer-details-form segment-form show">\n          <select id="acfw-send-coupon-to-segments" class="condition-value wc-enhanced-select" multiple data-placeholder="'.concat(g.pushengage.segment_placeholder,'" data-key="segments">\n            ').concat(zn(),'\n          </select>\n        </div>\n        \n        <div class="customer-details-form subscriber-form">\n          <select data-placeholder="').concat(g.pushengage.search,'" name="acfw_send_coupon[subscribers]" data-key="subscribers" class="wc-enhanced-select" multiple style="width:100%"></select>\n        </div>')}return""}function zn(){const{segments:e}=acfw_edit_coupon.send_coupon.pushengage;let t="";for(const o of e)t+='<option value="'.concat(o.segment_id,"-").concat(o.segment_name,'">').concat(o.segment_name,"</option>");return t+='<option value="create_new_segment">'.concat(g.pushengage.create_new_segment,"</option>"),t}function Jn(){return l.get("option")!=="pushengage"?"":'\n  <div class="acfw-send-coupon-form-section '.concat(l.get("section")==="message_details"?"current":"",'" data-section="message_details">\n    <div class="section-number">\n      <span>3</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(Rn(l.get("option")),'</h3>\n      <div class="section-content">\n        ').concat(Un(l.get("option")),'\n        <button type="button" class="button-primary acfw-next-section-btn" data-next_section="confirm_and_send">').concat(g.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}function Rn(e){switch(e){case"pushengage":return g.pushengage.message_details}return""}function Un(e){switch(e){case"pushengage":return'<div class="message-form show">\n          <div>\n            <label>'.concat(g.pushengage.title,'</label>\n            <input type="text" placeholder="').concat(g.pushengage.title_placeholder,'" value="').concat(l.get("title"),'" name="acfw_send_coupon[title]" data-key="title" />\n          </div>\n          <div>\n            <label>').concat(g.pushengage.message,'</label>\n            <input type="text" placeholder="').concat(g.pushengage.message_placeholder,'" value="').concat(l.get("message"),'" name="acfw_send_coupon[message]" data-key="message" />\n          </div>\n          <div>\n            <label>').concat(g.pushengage.url,'</label>\n            <input type="text" placeholder="').concat(g.pushengage.url_placeholder,'" value="').concat(l.get("url"),'" name="acfw_send_coupon[url]" data-key="url" />\n          </div>\n      </div>')}return""}function Wn(){return'\n  <div class="acfw-send-coupon-form-section '.concat(l.get("section")==="confirm_and_send"?"current":"",'" data-section="confirm_and_send">\n    <div class="section-number">\n      <span>').concat(l.get("option")==="email"?"3":"4",'</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(g.confirm_and_send,'</h3>\n      <div class="section-content">\n        ').concat(Zn(l.get("option")),"\n      </div>\n    </div>\n  </div>\n  ")}function Bn(){return'\n  <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.90625 8.59363V1.40613C8.90625 1.23328 8.7666 1.09363 8.59375 1.09363L1.40625 1.09363C1.2334 1.09363 1.09375 1.23328 1.09375 1.40613V4.92175C1.09375 4.96472 1.12891 4.99988 1.17188 4.99988H1.71875C1.76172 4.99988 1.79688 4.96472 1.79688 4.92175V1.79675L8.20313 1.79675V8.203H5.07813C5.03516 8.203 5 8.23816 5 8.28113V8.828C5 8.87097 5.03516 8.90613 5.07813 8.90613H8.59375C8.7666 8.90613 8.90625 8.76648 8.90625 8.59363ZM4.14648 6.37976L4.65625 6.88953C4.66663 6.89985 4.6797 6.90706 4.69397 6.91033C4.70824 6.91359 4.72314 6.91279 4.73697 6.90801C4.75081 6.90323 4.76303 6.89466 4.77224 6.88328C4.78145 6.8719 4.78728 6.85816 4.78906 6.84363L4.99414 5.09167C5 5.04187 4.95801 4.9989 4.90723 5.00476L3.15527 5.20984C3.09082 5.21765 3.06348 5.29675 3.10938 5.34265L3.62109 5.85437L1.11914 8.35632C1.08887 8.3866 1.08887 8.4364 1.11914 8.46667L1.5332 8.88074C1.56348 8.91101 1.61328 8.91101 1.64356 8.88074L4.14648 6.37976Z" fill="#3A6FAC"/>\n  </svg>\n  '}function Gn(){return'\n  <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.875 1.87512H1.125C0.917578 1.87512 0.75 2.0427 0.75 2.25012V9.75012C0.75 9.95754 0.917578 10.1251 1.125 10.1251H10.875C11.0824 10.1251 11.25 9.95754 11.25 9.75012V2.25012C11.25 2.0427 11.0824 1.87512 10.875 1.87512ZM10.4062 3.17356V9.28137H1.59375V3.17356L1.27031 2.92161L1.73086 2.32981L2.23242 2.72004H9.76875L10.2703 2.32981L10.7309 2.92161L10.4062 3.17356ZM9.76875 2.71887L6 5.64856L2.23125 2.71887L1.72969 2.32864L1.26914 2.92043L1.59258 3.17239L5.5957 6.28489C5.71083 6.37433 5.85246 6.42288 5.99824 6.42288C6.14403 6.42288 6.28566 6.37433 6.40078 6.28489L10.4062 3.17356L10.7297 2.92161L10.2691 2.32981L9.76875 2.71887Z" fill="white"/>\n  </svg>\n  '}function Yn(){return'\n    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M8.90625 8.59363V1.40613C8.90625 1.23328 8.7666 1.09363 8.59375 1.09363L1.40625 1.09363C1.2334 1.09363 1.09375 1.23328 1.09375 1.40613V4.92175C1.09375 4.96472 1.12891 4.99988 1.17188 4.99988H1.71875C1.76172 4.99988 1.79688 4.96472 1.79688 4.92175V1.79675L8.20313 1.79675V8.203H5.07813C5.03516 8.203 5 8.23816 5 8.28113V8.828C5 8.87097 5.03516 8.90613 5.07813 8.90613H8.59375C8.7666 8.90613 8.90625 8.76648 8.90625 8.59363ZM4.14648 6.37976L4.65625 6.88953C4.66663 6.89985 4.6797 6.90706 4.69397 6.91033C4.70824 6.91359 4.72314 6.91279 4.73697 6.90801C4.75081 6.90323 4.76303 6.89466 4.77224 6.88328C4.78145 6.8719 4.78728 6.85816 4.78906 6.84363L4.99414 5.09167C5 5.04187 4.95801 4.9989 4.90723 5.00476L3.15527 5.20984C3.09082 5.21765 3.06348 5.29675 3.10938 5.34265L3.62109 5.85437L1.11914 8.35632C1.08887 8.3866 1.08887 8.4364 1.11914 8.46667L1.5332 8.88074C1.56348 8.91101 1.61328 8.91101 1.64356 8.88074L4.14648 6.37976Z" fill="#3A6FAC"/>\n    </svg>\n  '}function Zn(e){var o;switch(e){case"email":var t=!l.get("name")||!l.get("email")?"disabled":"";return"<p>\n          <strong>".concat(g.email.customer,":</strong> ").concat((o=l.get("name"))!=null?o:"","\n          ").concat(l.get("email")?"&lt;".concat(l.get("email"),">"):"",'\n        </p>\n        <p><a class="preview-email-link  ').concat(t,'" href="#">').concat(g.email.preview_email," ").concat(Bn(),'</a></p>\n        <button type="button" class="button-primary acfw-send-email-btn" ').concat(t,">").concat(g.email.send_email," ").concat(Gn(),'</button>\n        <p class="request-message"></p>');case"pushengage":var t=!l.get("title")||!l.get("message")||!l.get("url")?"disabled":"";return l.get("send_to")==="subscribers"&&(t=t||l.get("subscriber_ids")==0?"disabled":""),"<p>\n          <strong>".concat(l.get("send_to")==="subscribers"?g.pushengage.subscribers:g.pushengage.segments,":</strong> ").concat(l.get("send_to")==="subscribers"?l.get("subscribers"):l.get("segments"),'\n        </p>\n        <p><a class="preview-pushengage-link ').concat(t,'" href="#">').concat(g.pushengage.preview_pushengage," ").concat(Yn(),'</a></p>\n        <button type="button" class="button-primary acfw-send-pushengage-btn" ').concat(t,">\n        ").concat(g.pushengage.send_pushengage,'</button>\n        <p class="request-message"></p>')}return""}const Kn=jQuery;function Xn(){return'\n    <div id="acfw-send-coupon">\n      <h2>'.concat(g.title,'</h2>\n\n      <div class="option-sections">\n        <label>').concat(g.select_options.label,'</label>\n        <select id="acfw-send-coupon-options" data-key="option">\n          ').concat(g.select_options.options.map(e=>"<option value='".concat(e.value,"'>").concat(e.label,"</option>")).join(""),'\n        </select>\n      </div>\n\n      <div class="description-sections">\n        <p class="description">').concat(g.description.email,'</p>\n      </div>\n\n      <div class="acfw-send-coupon-form-sections">\n        ').concat(B("send_coupon_to")(),"\n        ").concat(B("customer_details")(),"\n        ").concat(B("message_details")(),"\n        ").concat(B("confirm_and_send")(),"\n      </div>\n    </div>\n  ")}function W(e){const t=Kn(".acfw-send-coupon-form-sections"),o=t.find("[data-section='".concat(e,"']")),n=B(e)();l.get("option")!=="pushengage"&&t.find("[data-section='message_details']").remove();const i=t.find("[data-section='customer_details']");o.length?o.replaceWith(n):i.length?i.after(n):t.append(n)}function B(e){switch(e){case"send_coupon_to":return Nn;case"customer_details":return Hn;case"message_details":return Jn;case"confirm_and_send":return Wn}return()=>{}}const _=jQuery;function ei(){ti(),Ye(),_("body").on("click","button.acfw-send-coupon-btn",Se),_("body").on("change clearForm",".acfw-send-coupon-form-section input[type='radio']:checked",oi),_("body").on("click",".acfw-send-coupon-form-section .acfw-next-section-btn",ni),_("body").on("click",".acfw-send-coupon-form-section .section-number,.acfw-send-coupon-form-section h3",ii),_("body").on("change",".acfw-send-coupon-form-section input, .acfw-send-coupon-form-section select",je),_("body").on("click",".acfw-send-coupon-form-section .preview-email-link",ci),_("body").on("click",".acfw-send-coupon-form-section .preview-pushengage-link",ai),_("body").on("click",".acfw-send-coupon-form-section .acfw-send-email-btn",si),_("body").on("click",".acfw-send-coupon-form-section .acfw-send-pushengage-btn",li),_("body").on("click","#acfw-send-coupon .acfw-button-pushengage-install",ri),_("body").on("change","#acfw-send-coupon #acfw-send-coupon-options",di),_("body").on("change","#acfw-send-coupon #acfw-send-coupon-options",je),window.location.href.includes("sendcoupon")&&Se()}function ti(){_(".page-title-action").after(In())}function Se(){vex.dialog.open({unsafeMessage:Xn(),className:"vex-theme-plain acfw-send-coupon-modal",showCloseButton:!0,buttons:{},afterOpen:()=>_(document.body).trigger("wc-enhanced-select-init")})}function oi(){const t=_(this).val().toString();let o=t==="user"?".user-form":".guest-form";l.get("option")==="pushengage"&&(o=t==="subscribers"?".subscriber-form":".segment-form"),_(".acfw-send-coupon-form-section .customer-details-form").removeClass("show").find("input,select").prop("disabled",!0),_(".acfw-send-coupon-form-section ".concat(o)).addClass("show").find("input,select").prop("disabled",!1)}function ni(){const t=_(this).data("next_section");_(".acfw-send-coupon-form-section").removeClass("current"),_(".acfw-send-coupon-form-section[data-section='".concat(t,"']")).addClass("current"),l.set("section",t)}function ii(){const e=_(this).closest(".acfw-send-coupon-form-section");e.hasClass("current")||(_(".acfw-send-coupon-form-section").removeClass("current"),e.addClass("current")),l.set("section",e.data("section"))}function ci(){if(_(this).hasClass("disabled"))return;const t=new URLSearchParams;t.append("action","acfw_advanced_coupon_preview_email"),t.append("email_id","acfw_coupon_email"),t.append("args[coupon_id]",_("#post_ID").val()),t.append("args[name]",l.get("name")),t.append("args[email]",l.get("email")),t.append("args[user_id]",l.get("user_id")),t.append("_wpnonce",acfw_edit_coupon.send_coupon.form_email_nonce),window.open("".concat(ajaxurl,"?").concat(t.toString()),"_blank")}function ai(){if(_(this).hasClass("disabled"))return;const t=acfw_edit_coupon.send_coupon.pushengage.storename,o=acfw_edit_coupon.send_coupon.pushengage.coupon_code,n=l.get("url");let i=l.get("title"),c=l.get("message");i=i.replace("{storename}",t),c=c.replace("{coupon_code}",o);const a=new Notification(i,{body:c});a.onclick=function(s){s.preventDefault(),window.open(n,"_blank")}}function si(){_(this).prop("disabled",!0),_("#acfw-send-coupon .request-message").html("").removeClass("success error"),wp.apiFetch({path:"/coupons/v1/sendcoupon",method:"POST",data:{coupon_id:_("#post_ID").val(),customer:parseInt(l.get("user_id"))?l.get("user_id"):l.get("email"),name:l.get("name"),create_account:l.get("create_account")}}).then(t=>{be(),ie("success",t.message)}).catch(t=>ie("error",t.message))}function li(){_(this).prop("disabled",!0),_("#acfw-send-coupon .request-message").html("").removeClass("success error"),wp.apiFetch({path:"/coupons/v1/sendcoupon/pushengage",method:"POST",data:{coupon_id:_("#post_ID").val(),send_to:l.get("send_to"),segments:l.get("segments"),segment_ids:l.get("segment_ids"),subscribers:l.get("subscribers"),subscriber_ids:l.get("subscriber_ids"),title:l.get("title"),message:l.get("message"),url:l.get("url")}}).then(t=>{be("confirm_and_send","pushengage"),ie("success",t.message)}).catch(t=>ie("error",t.message))}function be(e="confirm_and_send",t="email"){Ye(e,t),_("#acfw-send-coupon").find("select:not(#acfw-send-coupon-options),input[type='text'],input[type='email']").val("").trigger("change"),_("#acfw-send-coupon").find("input[type='radio']").prop("checked",!1),_("#acfw-send-coupon").find("label:first-child input[type='radio']").prop("checked",!0).trigger("clearForm"),_("#acfw-send-coupon").find("input[type='checkbox']").prop("checked",!1),_("#acfw-send-coupon").find("input[name='acfw_send_coupon[title]']").val(acfw_edit_coupon.send_coupon.pushengage.default_content.title).trigger("change"),_("#acfw-send-coupon").find("input[name='acfw_send_coupon[url]']").val(acfw_edit_coupon.send_coupon.pushengage.default_content.url).trigger("change"),_("#acfw-send-coupon").find("input[name='acfw_send_coupon[message]']").val(acfw_edit_coupon.send_coupon.pushengage.default_content.message).trigger("change"),_("#acfw-send-coupon").find("select[name='acfw_send_coupon[subscribers]']").val(null).trigger("change")}function ie(e,t){_("#acfw-send-coupon .request-message").html(t).addClass(e)}function di(){let e="send_coupon_to";_(".acfw-send-coupon-form-section").removeClass("current"),_(".acfw-send-coupon-form-section[data-section='".concat(e,"']")).addClass("current");let t=_("#acfw-send-coupon-options").val();be(e,t),!acfw_edit_coupon.send_coupon.is_pushengage_plugin_active&&t==="pushengage"?(t="pushengage_not_installed",_(".acfw-send-coupon-form-sections").hide()):acfw_edit_coupon.send_coupon.is_pushengage_plugin_active&&t==="pushengage"&&!acfw_edit_coupon.send_coupon.is_pushengage_site_connected?(t="pushengage_site_not_connected",_(".acfw-send-coupon-form-sections").hide()):acfw_edit_coupon.send_coupon.is_pushengage_plugin_active&&t==="pushengage"&&acfw_edit_coupon.send_coupon.is_pushengage_error?(t="pushengage_error",_(".acfw-send-coupon-form-sections").hide()):_(".acfw-send-coupon-form-sections").show(),_("#acfw-send-coupon .description").html(g.description[t]),l.set("option",t),W("send_coupon_to"),W("customer_details"),t==="pushengage"&&W("message_details"),W("confirm_and_send"),_(document.body).trigger("wc-enhanced-select-init"),ui()}function ri(){const e=_(this),t=_('<span class="installing-text">'.concat(g.installing," ...</span>")),o=_('<span class="error-text" style="color: red; display: none;"></span>'),n=location.href;e.prop("disabled",!0).after(t).after(o),_.ajax({url:ajaxurl,type:"POST",data:{action:"acfw_install_activate_plugin",plugin_slug:"pushengage",silent:!0,nonce:acfw_edit_coupon.send_coupon.pushengage_download_nonce}}).done(i=>{i.success?(window.stop(),setTimeout(()=>{window.location.href=n},400)):o.text(i.data).show()}).fail(i=>{var a;t.remove();const c=((a=i.responseJSON)==null?void 0:a.data)||"An unexpected error occurred.";o.text(c).show(),e.prop("disabled",!1)})}function ui(){_('select.wc-enhanced-select[data-key="subscribers"]').select2({ajax:{url:ajaxurl,dataType:"json",data:e=>({action:"acfw_pushengage_subscribed_customer_search",search:e.term,nonce:acfw_edit_coupon.send_coupon.pushengage_subscriber_nonce}),processResults:e=>({results:e})}})}const{modules:X,upsell:pi}=acfw_edit_coupon;jQuery(document).ready(e=>{X.indexOf("acfw_cart_conditions_module")>-1&&eo(),X.indexOf("acfw_bogo_deals_module")>-1&&Qo(),X.indexOf("acfw_url_coupons_module")>-1&&No(),X.indexOf("acfw_scheduler_module")>-1&&zo(),pi&&Go(),Ao(),An(),Mn(),_i(),ei(),mn()});function _i(){const t=new URLSearchParams(window.location.search).get("type");t&&window.location.pathname.includes("post-new.php")&&jQuery("select#discount_type").val(t).trigger("change")}export{fi as __vite_legacy_guard};

if(function(f,e){"use strict";var s,g={is_ie:/(msie|trident)/i.test(navigator.userAgent),is_safari:/safari/i.test(navigator.userAgent),env:"production",xml_decl:'<?xml version="1.0" encoding="utf-8"?>',namespace:'xmlns:d="defiant-namespace"',tabsize:4,snapshots:{},renderXml:function(e,t){var n=new f.XSLTProcessor,r=document.createElement("span"),s='//xsl:template[@name="'+e+'"]',e=this.node.selectSingleNode(this.xsl_template,s);return(e=this.node.selectSingleNode(this.xsl_template,s)).setAttribute("match","/"),n.importStylesheet(this.xsl_template),r.appendChild(n.transformToFragment(t,document)),e.removeAttribute("match"),r.innerHTML},render:function(e,t){var n,r,s=new f.XSLTProcessor,a=document.createElement("span"),o={match:"/"};switch(typeof e){case"object":this.extend(o,e),o.data||(o.data=t);break;case"string":o.template=e,o.data=t;break;default:throw"error"}if(o.data=o.data.nodeType?o.data:g.json.toXML(o.data),t='//xsl:template[@name="'+o.template+'"]',this.xsl_template||this.gatherTemplates(),o.sorter&&(r=this.node.selectSingleNode(this.xsl_template,t+"//xsl:for-each//xsl:sort"))&&(o.sorter.order&&r.setAttribute("order",o.sorter.order),o.sorter.select&&r.setAttribute("select",o.sorter.select),r.setAttribute("data-type",o.sorter.type||"text")),(t=this.node.selectSingleNode(this.xsl_template,t)).setAttribute("match",o.match),s.importStylesheet(this.xsl_template),a.appendChild(s.transformToFragment(o.data,document)),t.removeAttribute("match"),this.is_safari)for(var i=0,l=(n=a.getElementsByTagName("script")).length;i<l;i++)n[i].defer=!0;return a.innerHTML},gatherTemplates:function(){for(var e=document.getElementsByTagName("script"),t="",n=0,r=e.length;n<r;n++)"defiant/xsl-template"===e[n].type&&(t+=e[n].innerHTML);this.xsl_template=this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xlink="http://www.w3.org/1999/xlink" '+this.namespace+">"+t.replace(/defiant:(\w+)/g,"$1")+"</xsl:stylesheet>")},registerTemplate:function(e){this.xsl_template=this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xlink="http://www.w3.org/1999/xlink" '+this.namespace+">"+e.replace(/defiant:(\w+)/g,"$1")+"</xsl:stylesheet>")},getSnapshot:function(e,t){return this.json.toXML(e,t||!0)},createSnapshot:function(e,t){var n=this,r="snapshot_"+Date.now();this.json.toXML(e,function(e){n.snapshots[r]=e,t(r)})},getFacets:function(e,t){var n,r,s,a,o,e=e.constructor===String&&"snapshot_"===e.slice(0,9)?this.snapshots[e].doc:g.json.toXML(e),i=e.cloneNode(!0),l={},c={},u=0,d=function(e){var t=e.childNodes.length;switch(e.nodeType){case 1:u<=t&&(u=t,r=e);case 9:e.childNodes.map(function(e){return d(e)})}};for(o in d(e),r.childNodes.map(function(e){c[e.nodeName]||(c[e.nodeName]=1),c[e.nodeName]++}),u=0,c)u<=c[o]&&(u=c[o],a=o);return this.createFacetTemplate(t),s=g.node.selectSingleNode(i,'//*[@d:mi="'+r.getAttribute("d:mi")+'"]'),g.node.selectNodes(i,'//*[@d:mi="'+r.getAttribute("d:mi")+'"]/'+a).map(function(e){return e.parentNode.removeChild(e)}),e=g.node.selectNodes(e,'//*[@d:mi="'+r.getAttribute("d:mi")+'"]/'+a),n=e.length-1,e.map(function(e,t){s.appendChild(e.cloneNode(!0)),t%50!=49&&t!==n||(t=g.render("facets",i).replace(/\n|\t/g,"").replace(/"": 0,?/g,"").replace(/,\}/g,"}"),t=JSON.parse(t),l=g.concatFacet(t,l),g.node.selectNodes(i,'//*[@d:mi="'+r.getAttribute("d:mi")+'"]/'+a).map(function(e){return e.parentNode.removeChild(e)}))}),l},createFacetTemplate:function(e){var t,n,r=[],s=[];for(n in e)r.push('<xsl:key name="'+n+'Key" match="'+e[n].group+'" use="'+e[n].key+'" />'),s.push('"'+n+'": {<xsl:for-each select="//'+e[n].group+"[@d:mi][count(. | key('"+n+"Key', "+e[n].key+')[1]) = 1]">"<xsl:value-of select="'+e[n].key+'" />": <xsl:value-of select="count(//'+e[n].group+"["+e[n].key+" = current()/"+e[n].key+'])" />'+'<xsl:if test="position() != last()">,</xsl:if></xsl:for-each>}'.replace(/\n|\t/g,""));t=r.join("")+'<xsl:template name="facets">{'+s.join(",")+"}</xsl:template>",this.registerTemplate(t)},xmlFromString:function(e){var t;return null===(e=e.replace(/>\s{1,}</g,"><")).trim().match(/<\?xml/)&&(e=this.xml_decl+e),"ActiveXObject"in f?((t=new ActiveXObject("Msxml2.DOMDocument")).loadXML(e),t.setProperty("SelectionNamespaces",this.namespace),-1===e.indexOf("xsl:stylesheet")&&t.setProperty("SelectionLanguage","XPath")):t=(new DOMParser).parseFromString(e,"text/xml"),t},concatFacet:function(e,t){for(var n in t)e[n]&&"object"==typeof t[n]?this.concatFacet(e[n],t[n]):e[n]=(e[n]||0)+t[n];return e},extend:function(e,t){for(var n in t)e[n]&&"object"==typeof t[n]?this.extend(e[n],t[n]):e[n]=t[n];return e},node:{selectNodes:function(e,t){if(e.evaluate){for(var n=e.createNSResolver(e.documentElement),r=e.evaluate(t,e,n,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),s=[],a=0,o=r.snapshotLength;a<o;a++)s.push(r.snapshotItem(a));return s}return e.selectNodes(t)},selectSingleNode:function(e,t){if(e.evaluate){var n=this.selectNodes(e,t);return 0<n.length?n[0]:null}return e.selectSingleNode(t)},prettyPrint:function(e){var t=g,n=t.tabsize,r=t.xml_decl.toLowerCase(),e=t.is_ie?e.xml:(new XMLSerializer).serializeToString(e);"development"!==t.env&&(e=e.replace(/ \w+\:d=".*?"| d\:\w+=".*?"/g,""));for(var s,a,o=e.trim().replace(/(>)\s*(<)(\/*)/g,"$1\n$2$3").split("\n"),i=-1,l=0,c=o.length;l<c;l++)0===l&&o[l].toLowerCase()===r||(s=null!==o[l].match(/<[A-Za-z_\:]+.*?>/g),a=null!==o[l].match(/<\/[\w\:]+>/g),null!==o[l].match(/<.*?\/>/g)&&(s=a=!0),s&&i++,o[l]=String().fill(i,"\t")+o[l],s&&a&&i--,!s&&a&&i--);return o.join("\n").replace(/\t/g,String().fill(n," "))},toJSON:function(e,t){var m=function(e){var t,n,r,s,a,o,i,l,c,u,d={},p=f;switch(e.nodeType){case 1:for("Array"===(a=e.getAttribute("d:constr"))?d=[]:"String"===a&&""===e.textContent&&(d=""),l=0,c=(t=e.attributes).length;l<c;l++)null===(u=t.item(l)).nodeName.match(/\:d|d\:/g)&&(o=(a=e.getAttribute("d:"+u.nodeName))&&"undefined"!==a?"null"===u.nodeValue?null:p[a]("false"===u.nodeValue?"":u.nodeValue):u.nodeValue,d["@"+u.nodeName]=o);break;case 3:d=o=(n=e.parentNode.getAttribute("d:type"))?p[n]("false"===e.nodeValue?"":e.nodeValue):e.nodeValue}if(e.hasChildNodes())for(l=0,c=e.childNodes.length;l<c;l++)if(s=(r=e.childNodes.item(l)).nodeName,t=e.attributes,"d:name"===s&&(s=r.getAttribute("d:name")),"#text"===s)"undefined"===(a=e.getAttribute("d:constr"))&&(a=void 0),i=r.textContent||r.text,o="Boolean"===a&&"false"===i?"":i,a||t.length?a&&1===c?d=p[a](o):e.hasChildNodes()&&t.length<3?d=a?p[a](o):o:d[s]=a?p[a](o):o:d=o;else{if("null"===r.getAttribute("d:constr")){d[s]&&d[s].push?d[s].push(null):"ArrayItem"===r.getAttribute("d:type")?d[s]=[d[s]]:d[s]=null;continue}if(d[s]){d[s].push?d[s].push(m(r)):d[s]=[d[s],m(r)];continue}switch(a=r.getAttribute("d:constr")){case"null":d.push?d.push(null):d[s]=null;break;case"Array":r.parentNode.firstChild===r&&"Array"===a&&"d:item"!==s?"d:item"===s||"Array"===a?(o=m(r),d[s]=o.length?[o]:o):d[s]=m(r):d.push?d.push(m(r)):d[s]=m(r);break;case"String":case"Number":case"Boolean":i=r.textContent||r.text,o="Boolean"===a&&"false"===i?"":i,d.push?d.push(p[a](o)):d[s]=m(r);break;default:d.push?d.push(m(r)):d[s]=m(r)}}return 1===e.nodeType&&"ArrayItem"===e.getAttribute("d:type")&&(d=[d]),d},n=9===e.nodeType?e.documentElement:e,r=m(n),e=r[n.nodeName];return n===n.ownerDocument.documentElement&&e&&e.constructor===Array&&(r=e),t&&"true"===t.toString()&&(t="\t"),t?JSON.stringify(r,null,t):r}},json:{interpreter:{map:[],rx_validate_name:/^(?!xml)[a-z_][\w\d.:]*$/i,rx_node:/<(.+?)( .*?)>/,rx_constructor:/<(.+?)( d:contr=".*?")>/,rx_namespace:/ xmlns\:d="defiant\-namespace"/,rx_data:/(<.+?>)(.*?)(<\/d:data>)/i,rx_function:/function (\w+)/i,namespace:'xmlns:d="defiant-namespace"',to_xml_str:function(e){return{str:this.hash_to_xml(null,e),map:this.map}},hash_to_xml:function(n,e,r){function t(e,t){if(null!==(a=t[e])&&void 0!==a&&"NaN"!==a.toString()||(a=null),i="@"===e.slice(0,1),(l=r?n:e)==+l&&t.constructor!==Object&&(l="d:item"),u=null===a?(c=null,!1):(c=a.constructor).toString().match(h.rx_function)[1],i)g.push(l.slice(1)+'="'+h.escape_xml(a)+'"'),"String"!==u&&g.push("d:"+l.slice(1)+'="'+u+'"');else if(null===a)f.push(h.scalar_to_xml(l,a));else switch(c){case Function:throw"JSON data should not contain functions. Please check your structure.";case Object:f.push(h.hash_to_xml(l,a));break;case Array:if(e===l){if(o=a.constructor===Array)for(d=a.length;d--;)null!==a[d]&&a[d]&&a[d].constructor!==Array||(o=!0),o||a[d].constructor!==Object||(o=!0);f.push(h.scalar_to_xml(l,a,o));break}case String:if("string"==typeof a&&(a=a.toString().replace(/\&/g,"&amp;").replace(/\r|\n/g,"&#13;")),"#text"===l){h.map.push(t),g.push('d:mi="'+h.map.length+'"'),g.push('d:constr="'+u+'"'),f.push(h.escape_xml(a));break}case Number:case Boolean:if("#text"===l&&"String"!==u){h.map.push(t),g.push('d:mi="'+h.map.length+'"'),g.push('d:constr="'+u+'"'),f.push(h.escape_xml(a));break}f.push(h.scalar_to_xml(l,a))}}var s,a,o,i,l,c,u,d,p,m=e.constructor===Array,h=this,f=[],g=[];if(e.constructor===Array)for(d=0,p=e.length;d<p;d++)t(d.toString(),e);else for(s in e)t(s,e);return n||(n="d:data",g.push(this.namespace),m&&g.push('d:constr="Array"')),null===n.match(this.rx_validate_name)&&(g.push('d:name="'+n+'"'),n="d:name"),r?f.join(""):(this.map.push(e),g.push('d:mi="'+this.map.length+'"'),"<"+n+(g.length?" "+g.join(" "):"")+(f.length?">"+f.join("")+"</"+n+">":"/>"))},scalar_to_xml:function(e,t,n){var r,s="";if(null===e.match(this.rx_validate_name)&&(s+=' d:name="'+e+'"',n=!(e="d:name")),null!==t&&"NaN"!==t.toString()||(t=null),null===t)return"<"+e+' d:constr="null"/>';if(1===t.length&&t.constructor===Array&&!t[0])return"<"+e+' d:constr="null" d:type="ArrayItem"/>';if(1!==t.length||t[0].constructor!==Object)return 0===t.length&&t.constructor===Array?"<"+e+' d:constr="Array"/>':n?this.hash_to_xml(e,t,!0):(n=(r=t.constructor).toString().match(this.rx_function)[1],r=r===Array?this.hash_to_xml("d:item",t,!0):this.escape_xml(t),s+=' d:constr="'+n+'"',this.map.push(t),s+=' d:mi="'+this.map.length+'"',"#text"===e?this.escape_xml(t):"<"+e+s+">"+r+"</"+e+">");s=(r=this.hash_to_xml(!1,t[0])).match(this.rx_node),t=r.match(this.rx_constructor);return"<"+e+(s=null!==s?s[2].replace(this.rx_namespace,"").replace(/>/,"").replace(/"\/$/,'"'):"")+" "+(t=null!==t?t[2]:"")+' d:type="ArrayItem">'+(r=null!==(r=r.match(this.rx_data))?r[2]:"")+"</"+e+">"},escape_xml:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&nbsp;/g,"&#160;")}},toXML:function(t,n){var e,r=g.json.interpreter;switch(typeof n){case"function":return void g.compiled.to_xml_str(t,function(e){n({doc:g.xmlFromString(e.str),src:t,map:e.map})});case"boolean":return e=r.to_xml_str.call(r,t),{doc:g.xmlFromString(e.str),src:t,map:e.map};default:return e=r.to_xml_str.call(r,t),r=g.xmlFromString(e.str),this.search.map=e.map,r}},search:function(e,t,n){e.constructor===String&&"snapshot_"===e.slice(0,9)&&g.snapshots[e]&&(e=g.snapshots[e]);var r,s,a=g.json,o=e.doc&&e.doc.nodeType,i=o?e.doc:a.toXML(e),l=(o?e:a.search).map,e=o?e.src:e,c=g.node[n?"selectSingleNode":"selectNodes"](i,t.xTransform()),u=[];for(n&&(c=[c]),s=c.length;s--;)switch(c[s].nodeType){case 2:case 3:u.unshift(c[s].nodeValue);break;default:r=+c[s].getAttribute("d:mi"),u.unshift(l[r-1])}return"development"===g.env&&(u.trace=a.matchTrace(e,u,c)),u},matchTrace:function(e,i,l){function c(e){return JSON.stringify(e,null,"\t").replace(/\t/g,"")}var u=[],d=0,p=f,m=g.node.toJSON,h=c(e);return l.map(function(e,t){var n,r,s,a,o=0;switch(e.nodeType){case 2:n=l[t].ownerElement?l[t].ownerElement.getAttribute("d:"+l[t].nodeName):"String",r=p[n](i[t]),s='"@'+l[t].nodeName+'": '+r,a=h.indexOf(s,d);break;case 3:n=l[t].parentNode.getAttribute("d:constr"),r=p[n](i[t]),s='"'+l[t].parentNode.nodeName+'": '+("Number"===s?r:'"'+r+'"'),a=h.indexOf(s,d);break;default:n=e.getAttribute("d:constr"),-1<["String","Number"].indexOf(n)?(e=m(l[t].parentNode),e=c(e),r=p[n](i[t]),s='"'+l[t].nodeName+'": '+("Number"===n?r:'"'+r+'"'),a=h.indexOf(e,d)+e.indexOf(s)):(s=c(i[t]),a=h.indexOf(s),o=s.split("\n").length-1)}d=a+1,a=h.slice(0,a).split("\n").length,u.push([a,o])}),u}}},a={id:1,work_handler:function(e){var t=Array.prototype.slice.call(e.data,2),n=e.data[0],e=e.data[1],t=tree[n].apply(tree,t);t.map=JSON.parse(JSON.stringify(t.map)),postMessage([e,n,t])},setup:function(e){var t=f.URL||f.webkitURL,e="var tree = {"+this.parse(e).join(",")+"};",e=new Blob([e+'self.addEventListener("message", '+this.work_handler.toString()+", false);"],{type:"text/javascript"}),e=new Worker(t.createObjectURL(e));return e.onmessage=function(e){var t=Array.prototype.slice.call(e.data,2),n=e.data[0],e=e.data[1];a.observer.emit("x10:"+e+n,t),a.observer.off("x10:"+e+n)},e},call_handler:function(r,s){return function(){var e=Array.prototype.slice.call(arguments,0,-1),t=arguments[arguments.length-1],n=a.id++;e.unshift(n),e.unshift(r),a.observer.on("x10:"+r+n,function(e){t(e.detail[0])}),s.postMessage(e)}},compile:function(e){var t,n=this.setup("function"==typeof e?{func:e}:e),r={};if("function"==typeof e)return r.func=this.call_handler("func",n),r.func;for(t in e)r[t]=this.call_handler(t,n);return r},parse:function(e,t){var n,r,s,a=[];for(n in e)if(null!==(s=e[n]))if(void 0!==s){switch(s.constructor){case Date:r="new Date("+s.valueOf()+")";break;case Object:r="{"+this.parse(s).join(",")+"}";break;case Array:r="["+this.parse(s,!0).join(",")+"]";break;case String:r='"'+s.replace(/"/g,'\\"')+'"';break;case RegExp:case Function:r=s.toString();break;default:r=s}t?a.push(r):a.push(n+":"+r)}else a.push(n+":undefined");else a.push(n+":null");return a},observer:(s={},{on:function(e,t){s[e]||(s[e]=[]),s[e].unshift(t)},off:function(e,t){s[e]&&(t=s[e].indexOf(t),s[e].splice(t,1))},emit:function(e,t){if(s[e])for(var n={type:e,detail:t,isCanceled:!1,cancelBubble:function(){this.isCanceled=!0}},r=s[e].length;r--;){if(n.isCanceled)return;s[e][r](n)}}})};String.prototype.fill||(String.prototype.fill=function(e,t){var n=this;for(t=t||" ";n.length<e;n+=t);return n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")}),String.prototype.xTransform||(String.prototype.xTransform=function(){var e=this;return-1===this.indexOf("translate(")&&(e=this.replace(/contains\(([^,]+),([^\\)]+)\)/g,function(e,t,n){var r="abcdefghijklmnopqrstuvwxyz";return"contains(translate("+t+', "'+r.toUpperCase()+'", "'+r+'"),'+n.toLowerCase()+")"})),e.toString()}),g.compiled=a.compile(g.json.interpreter),g.search=g.json.search,g.x10=a,JSON.search=function(e,t,n){return console.warn('[Deprication] Defiant will stop extending the JSON object. Please use this method instead; "defiant.json.search".'),g.json.search(e,t,n)},JSON.toXML=function(e){return console.warn('[Deprication] Defiant will stop extending the JSON object. Please use this method instead; "defiant.json.toXML".'),g.json.toXML(e)},NodeList.prototype.map=Array.prototype.map,f.defiant=f.defiant||g,e.exports=g}("undefined"!=typeof window?window:{},"undefined"!=typeof module?module:{}),window.XSLTProcessor||void 0!==XSLTProcessor){if("function"!=typeof XSLTProcessor&&!window.XSLTProcessor)throw"XSLTProcessor transformNode not implemented"}else{var XSLTProcessor=function(){};XSLTProcessor.prototype={importStylesheet:function(e){this.xsldoc=e},transformToFragment:function(e,t){var n=e.transformNode(this.xsldoc),e=document.createElement("span");return e.innerHTML=n,e}}}